!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).BoardgameIO={})}(this,(function(e){"use strict";var t=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),n=function(){return Math.random().toString(36).substring(7).split("").join(".")},r={INIT:"@@redux/INIT"+n(),REPLACE:"@@redux/REPLACE"+n(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+n()}};function o(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function a(e,n,i){var s;if("function"==typeof n&&"function"==typeof i||"function"==typeof i&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof n&&void 0===i&&(i=n,n=void 0),void 0!==i){if("function"!=typeof i)throw new Error("Expected the enhancer to be a function.");return i(a)(e,n)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var l=e,c=n,u=[],d=u,p=!1;function f(){d===u&&(d=u.slice())}function v(){if(p)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return c}function h(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(p)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return f(),d.push(e),function(){if(t){if(p)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,f();var n=d.indexOf(e);d.splice(n,1)}}}function m(e){if(!o(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(p)throw new Error("Reducers may not dispatch actions.");try{p=!0,c=l(c,e)}finally{p=!1}for(var t=u=d,n=0;n<t.length;n++){(0,t[n])()}return e}function g(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");l=e,m({type:r.REPLACE})}function y(){var e,n=h;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function t(){e.next&&e.next(v())}return t(),{unsubscribe:n(t)}}})[t]=function(){return this},e}return m({type:r.INIT}),(s={dispatch:m,subscribe:h,getState:v,replaceReducer:g})[t]=y,s}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(n,!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function u(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},a=t.map((function(e){return e(o)}));return l({},n,{dispatch:r=c.apply(void 0,a)(n.dispatch)})}}}const d=(e,t,n,r)=>({type:"MAKE_MOVE",payload:{type:e,args:t,playerID:n,credentials:r}}),p=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r}}),f=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r},automatic:!0}),v=e=>({type:"SYNC",state:e.state,log:e.log,initialState:e.initialState,clientOnly:!0}),h=e=>({type:"RESET",state:e,clientOnly:!0}),m=(e,t)=>({type:"UNDO",payload:{type:null,args:null,playerID:e,credentials:t}}),g=(e,t)=>({type:"REDO",payload:{type:null,args:null,playerID:e,credentials:t}});var y,b,x,$=Object.freeze({makeMove:d,gameEvent:p,automaticGameEvent:f,sync:v,update:(e,t)=>({type:"UPDATE",state:e,deltalog:t,clientOnly:!0}),reset:h,undo:m,redo:g,plugin:(e,t,n,r)=>({type:"PLUGIN",payload:{type:e,args:t,playerID:n,credentials:r}})}),w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),O="undefined"!=typeof Symbol?Symbol("immer-nothing"):(x=!0,(b="immer-nothing")in(y={})?Object.defineProperty(y,b,{value:x,enumerable:!0,configurable:!0,writable:!0}):y[b]=x,y),k="undefined"!=typeof Symbol?Symbol("immer-draftable"):"__$immer_draftable",I="undefined"!=typeof Symbol?Symbol("immer-state"):"__$immer_state";function _(e){return!!e&&!!e[I]}function E(e){if(!e||"object"!==(void 0===e?"undefined":w(e)))return!1;if(Array.isArray(e))return!0;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype||(!!e[k]||!!e.constructor[k])}var D=Object.assign||function(e,t){for(var n in t)M(t,n)&&(e[n]=t[n]);return e},j="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function S(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Array.isArray(e))return e.slice();var n=Object.create(Object.getPrototypeOf(e));return j(e).forEach((function(r){if(r!==I){var o=Object.getOwnPropertyDescriptor(e,r);if(o.get){if(!t)throw new Error("Immer drafts cannot have computed properties");o.value=o.get.call(e)}o.enumerable?n[r]=o.value:Object.defineProperty(n,r,{value:o.value,writable:!0,configurable:!0})}})),n}function A(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(n,e[n],e);else j(e).forEach((function(n){return t(n,e[n],e)}))}function C(e,t){return Object.getOwnPropertyDescriptor(e,t).enumerable}function M(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function z(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}var N={},B=[],G=function(){return B[B.length-1]};function q(e,t){var n=Array.isArray(e),r=K(e);A(r,(function(t){!function(e,t,n){var r=N[t];r?r.enumerable=n:N[t]=r={configurable:!0,enumerable:n,get:function(){return function(e,t){F(e);var n=T(e)[t];if(!e.finalizing&&n===e.base[t]&&E(n))return U(e),e.copy[t]=q(n,e);return n}(this[I],t)},set:function(e){!function(e,t,n){if(F(e),e.assigned[t]=!0,!e.modified){if(z(T(e)[t],n))return;R(e),U(e)}e.copy[t]=n}(this[I],t,e)}};Object.defineProperty(e,t,r)}(r,t,n||C(e,t))}));var o={scope:t?t.scope:G(),modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:t,base:e,draft:r,copy:null,revoke:L,revoked:!1};return function(e,t,n){Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0})}(r,I,o),o.scope.push(o),r}function L(){this.revoked=!0}function T(e){return e.copy||e.base}function R(e){e.modified||(e.modified=!0,e.parent&&R(e.parent))}function U(e){e.copy||(e.copy=K(e.base))}function K(e){var t=e&&e[I];if(t){t.finalizing=!0;var n=S(t.draft,!0);return t.finalizing=!1,n}return S(e)}function F(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(T(e)))}function V(e){for(var t=e.base,n=e.draft,r=Object.keys(n),o=r.length-1;o>=0;o--)if(void 0===t[r[o]]&&!M(t,r[o]))return!0;return r.length!==Object.keys(t).length}function J(e){var t=e.draft;if(t.length!==e.base.length)return!0;var n=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!n||n.get)}var H=Object.freeze({scopes:B,currentScope:G,willFinalize:function(e,t,n){var r=G();r.forEach((function(e){return e.finalizing=!0})),void 0!==e&&e!==t||(n&&function e(t){if(!t||"object"!==(void 0===t?"undefined":w(t)))return;var n=t[I];if(!n)return;var r=n.base,o=n.draft,a=n.assigned;if(Array.isArray(t)){if(J(n)){if(R(n),a.length=!0,o.length<r.length)for(var i=o.length;i<r.length;i++)a[i]=!1;else for(var s=r.length;s<o.length;s++)a[s]=!0;for(var l=0;l<o.length;l++)void 0===a[l]&&e(o[l])}}else Object.keys(o).forEach((function(t){void 0!==r[t]||M(r,t)?a[t]||e(o[t]):(a[t]=!0,R(n))})),Object.keys(r).forEach((function(e){void 0!==o[e]||M(o,e)||(a[e]=!1,R(n))}))}(t),function(e){for(var t=e.length-1;t>=0;t--){var n=e[t];!1===n.modified&&(Array.isArray(n.base)?J(n)&&R(n):V(n)&&R(n))}}(r))},createDraft:q}),W=[],Y=function(){return W[W.length-1]};function Q(e,t){var n={scope:t?t.scope:Y(),modified:!1,finalized:!1,assigned:{},parent:t,base:e,draft:null,drafts:{},copy:null,revoke:null},r=Array.isArray(e)?Proxy.revocable([n],Z):Proxy.revocable(n,X),o=r.revoke,a=r.proxy;return n.draft=a,n.revoke=o,n.scope.push(n),a}var X={get:function(e,t){if(t===I)return e;var n=e.drafts;if(!e.modified&&M(n,t))return n[t];var r=ee(e)[t];if(e.finalized||!E(r))return r;if(e.modified){if(r!==e.base[t])return r;n=e.copy}return n[t]=Q(r,e)},has:function(e,t){return t in ee(e)},ownKeys:function(e){return Reflect.ownKeys(ee(e))},set:function(e,t,n){if(!e.modified){if(n?z(e.base[t],n)||n===e.drafts[t]:z(e.base[t],n)&&t in e.base)return!0;te(e)}return e.assigned[t]=!0,e.copy[t]=n,!0},deleteProperty:function(e,t){(void 0!==e.base[t]||t in e.base)&&(e.assigned[t]=!1,te(e));e.copy&&delete e.copy[t];return!0},getOwnPropertyDescriptor:function(e,t){var n=ee(e),r=Reflect.getOwnPropertyDescriptor(n,t);r&&(r.writable=!0,r.configurable=!Array.isArray(n)||"length"!==t);return r},defineProperty:function(){throw new Error("Object.defineProperty() cannot be used on an Immer draft")},getPrototypeOf:function(e){return Object.getPrototypeOf(e.base)},setPrototypeOf:function(){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}},Z={};function ee(e){return e.copy||e.base}function te(e){e.modified||(e.modified=!0,e.copy=D(S(e.base),e.drafts),e.drafts=null,e.parent&&te(e.parent))}A(X,(function(e,t){Z[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Z.deleteProperty=function(e,t){if(isNaN(parseInt(t)))throw new Error("Immer only supports deleting array indices");return X.deleteProperty.call(this,e[0],t)},Z.set=function(e,t,n){if("length"!==t&&isNaN(parseInt(t)))throw new Error("Immer only supports setting array indices and the 'length' property");return X.set.call(this,e[0],t,n)};var ne=Object.freeze({scopes:W,currentScope:Y,willFinalize:function(){},createDraft:Q});function re(e,t,n,r){Array.isArray(e.base)?function(e,t,n,r){for(var o=e.base,a=e.copy,i=e.assigned,s=Math.min(o.length,a.length),l=0;l<s;l++)if(i[l]&&o[l]!==a[l]){var c=t.concat(l);n.push({op:"replace",path:c,value:a[l]}),r.push({op:"replace",path:c,value:o[l]})}if(s<a.length){for(var u=s;u<a.length;u++)n.push({op:"add",path:t.concat(u),value:a[u]});r.push({op:"replace",path:t.concat("length"),value:o.length})}else if(s<o.length){n.push({op:"replace",path:t.concat("length"),value:a.length});for(var d=s;d<o.length;d++)r.push({op:"add",path:t.concat(d),value:o[d]})}}(e,t,n,r):function(e,t,n,r){var o=e.base,a=e.copy;A(e.assigned,(function(e,i){var s=o[e],l=a[e],c=i?e in o?"replace":"add":"remove";if(s!==l||"replace"!==c){var u=t.concat(e);n.push("remove"===c?{op:c,path:u}:{op:c,path:u,value:l}),r.push("add"===c?{op:"remove",path:u}:"remove"===c?{op:"add",path:u,value:s}:{op:"replace",path:u,value:s})}}))}(e,t,n,r)}function oe(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=r.path;if(0===o.length&&"replace"===r.op)e=r.value;else{for(var a=e,i=0;i<o.length-1;i++)if(!(a=a[o[i]])||"object"!==(void 0===a?"undefined":w(a)))throw new Error("Cannot apply patch, path doesn't resolve: "+o.join("/"));var s=o[o.length-1];switch(r.op){case"replace":case"add":a[s]=r.value;break;case"remove":if(Array.isArray(a)){if(s!==a.length-1)throw new Error("Only the last index of an array can be removed, index: "+s+", length: "+a.length);a.length-=1}else delete a[s];break;default:throw new Error("Unsupported patch operation: "+r.op)}}}return e}var ae={useProxies:"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect,autoFreeze:"undefined"==typeof process&&"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},ie=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),D(this,ae,t),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this)}return P(e,[{key:"produce",value:function(e,t,n){var r=this;if("function"==typeof e&&"function"!=typeof t){var o=t;return t=e,function(){for(var e=arguments.length,n=Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return r.produce(i,(function(e){var r;return(r=t).call.apply(r,[e,e].concat(n))}))}}if("function"!=typeof t)throw new Error("if first argument is not a function, the second argument to produce should be a function");if(void 0!==n&&"function"!=typeof n)throw new Error("the third argument of a producer should not be set or a function");var a=void 0;if(E(e)){this.scopes.push([]);var i=this.createDraft(e);try{a=t.call(i,i),this.willFinalize(a,i,!!n);var s=n&&[],l=n&&[];if(void 0===a||a===i)a=this.finalize(i,[],s,l);else{if(i[I].modified)throw new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");E(a)&&(a=this.finalize(a)),n&&(s.push({op:"replace",path:[],value:a}),l.push({op:"replace",path:[],value:e}))}}finally{this.currentScope().forEach((function(e){return e.revoke()})),this.scopes.pop()}n&&n(s,l)}else if(void 0===(a=t(e)))return e;return a===O?void 0:a}},{key:"setAutoFreeze",value:function(e){this.autoFreeze=e}},{key:"setUseProxies",value:function(e){this.useProxies=e,D(this,e?ne:H)}},{key:"applyPatches",value:function(e,t){return _(e)?oe(e,t):this.produce(e,(function(e){return oe(e,t)}))}},{key:"finalize",value:function(e,t,n,r){var o=this,a=e[I];if(!a)return Object.isFrozen(e)?e:this.finalizeTree(e);if(a.scope!==this.currentScope())return e;if(!a.modified)return a.base;if(!a.finalized){if(a.finalized=!0,this.finalizeTree(a.draft,t,n,r),this.onDelete)if(this.useProxies){var i=a.assigned;for(var s in i)i[s]||this.onDelete(a,s)}else{var l=a.base,c=a.copy;A(l,(function(e){M(c,e)||o.onDelete(a,e)}))}this.onCopy&&this.onCopy(a),this.autoFreeze&&1===this.scopes.length&&Object.freeze(a.copy),n&&re(a,t,n,r)}return a.copy}},{key:"finalizeTree",value:function(e,t,n,r){var o=this,a=e[I];a&&(this.useProxies||(a.finalizing=!0,a.copy=S(a.draft,!0),a.finalizing=!1),e=a.copy);var i=this.onAssign;return A(e,(function s(l,c,u){if(c===u)throw Error("Immer forbids circular references");var d=!!a&&u===e;if(_(c)){if(c=n&&d&&!a.assigned[l]?o.finalize(c,t.concat(l),n,r):o.finalize(c),Array.isArray(u)||C(u,l)?u[l]=c:Object.defineProperty(u,l,{value:c}),d&&c===a.base[l])return}else{if(d&&z(c,a.base[l]))return;E(c)&&!Object.isFrozen(c)&&A(c,s)}d&&i&&i(a,l,c)})),e}}]),e}()),se=ie.produce;ie.setAutoFreeze.bind(ie),ie.setUseProxies.bind(ie),ie.applyPatches.bind(ie);const le={name:"plugin-immer",fnWrap:e=>(t,n,...r)=>{let o=!1;const a=se(t,t=>{const a=e(t,n,...r);if("INVALID_MOVE"!==a)return a;o=!0});return o?"INVALID_MOVE":a}};function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(n,!0).forEach((function(t){de(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ve(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function he(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function me(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function ge(e,t){var n=new he(e),r=t&&t.state,o=n.next;return o.quick=o,r&&("object"==ce(r)&&me(r,n),o.state=function(){return me(n,{})}),o}var ye=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=t,this.used=!1}var t,n,r;return t=e,(n=[{key:"isUsed",value:function(){return this.used}},{key:"getState",value:function(){return this.state}},{key:"_random",value:function(){this.used=!0;var e,t=this.state,n=(e=void 0===t.prngstate?new ge(t.seed,{state:!0}):new ge("",{state:t.prngstate}))();return this.state=fe({},t,{prngstate:e.state()}),n}},{key:"api",value:function(){var e=this._random.bind(this),t={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},n={},r=function(r){var o=t[r];n[r]=function(t){return void 0===t?Math.floor(e()*o)+1:ve(new Array(t).keys()).map((function(){return Math.floor(e()*o)+1}))}};for(var o in t)r(o);return fe({},n,{Die:function(t,n){return void 0===t&&(t=6),void 0===n?Math.floor(e()*t)+1:ve(new Array(n).keys()).map((function(){return Math.floor(e()*t)+1}))},Number:function(){return e()},Shuffle:function(t){for(var n=t.slice(0),r=t.length,o=0,a=new Array(r);r;){var i=r*e()|0;a[o++]=n[i],n[i]=n[--r]}return a},_obj:this})}}])&&ue(t.prototype,n),r&&ue(t,r),e}();ye.seed=function(){return(+new Date).toString(36).slice(-10)};class be{constructor(e,t){this.flow=e,this.playerID=t,this.dispatch=[]}api(e){const t={_obj:this},{phase:n,turn:r}=e;for(const e of this.flow.eventNames)t[e]=(...t)=>{this.dispatch.push({key:e,args:t,phase:n,turn:r})};return t}isUsed(){return this.dispatch.length>0}update(e){for(let t=0;t<this.dispatch.length;t++){const n=this.dispatch[t];if("endTurn"===n.key&&n.turn!==e.ctx.turn)continue;if(("endPhase"===n.key||"setPhase"===n.key)&&n.phase!==e.ctx.phase)continue;const r=f(n.key,n.args,this.playerID);e={...e,...this.flow.processEvent(e,r)}}return e}}const xe=[le,{name:"random",noClient:({api:e})=>e._obj.isUsed(),flush:({api:e})=>e._obj.getState(),api:({data:e})=>new ye(e).api(),setup:({game:e})=>{let t=e.seed;return void 0===t&&(t=ye.seed()),{seed:t}}},{name:"events",noClient:({api:e})=>e._obj.isUsed(),dangerouslyFlushRawState:({state:e,api:t})=>t._obj.update(e),api:({game:e,playerID:t,ctx:n})=>new be(e.flow,t).api(n)}],$e=e=>{let t={...e.ctx};const n=e.plugins||{};return Object.entries(n).forEach(([e,{api:n}])=>{t[e]=n}),t},we=(e,t)=>[...xe,...t].filter(e=>void 0!==e.fnWrap).reduce((e,{fnWrap:t})=>t(e),e),Pe=(e,t)=>([...xe,...t.game.plugins].filter(e=>void 0!==e.api).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},a=n.api({G:e.G,ctx:e.ctx,data:o.data,game:t.game,playerID:t.playerID});e={...e,plugins:{...e.plugins,[r]:{...o,api:a}}}}),e),Oe=(e,t)=>([...xe,...t.game.plugins].reverse().forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}};if(n.flush){const r=n.flush({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data});e={...e,plugins:{...e.plugins,[n.name]:{data:r}}}}else if(n.dangerouslyFlushRawState){const a=(e=n.dangerouslyFlushRawState({state:e,game:t.game,api:o.api,data:o.data})).plugins[r].data;e={...e,plugins:{...e.plugins,[n.name]:{data:a}}}}}),e),ke=console.log,Ie=console.error;function _e(e){Ie("ERROR:",e)}function Ee(e,t,n){return{...e,ctx:De(e.ctx,n)}}function De(e,t){let{_prevActivePlayers:n}=e,r={},o=null,a={};if(Array.isArray(t)){let e={};t.forEach(t=>e[t]=Ce.NULL),r=e}else{if(t.next&&(o=t.next),n=t.revert?n.concat({activePlayers:e.activePlayers,_activePlayersMoveLimit:e._activePlayersMoveLimit,_activePlayersNumMoves:e._activePlayersNumMoves}):[],void 0!==t.currentPlayer&&je(r,a,e.currentPlayer,t.currentPlayer),void 0!==t.others)for(let n=0;n<e.playOrder.length;n++){const o=e.playOrder[n];o!==e.currentPlayer&&je(r,a,o,t.others)}if(void 0!==t.all)for(let n=0;n<e.playOrder.length;n++){je(r,a,e.playOrder[n],t.all)}if(t.value)for(const e in t.value)je(r,a,e,t.value[e]);if(t.moveLimit)for(const e in r)void 0===a[e]&&(a[e]=t.moveLimit)}0==Object.keys(r).length&&(r=null),0==Object.keys(a).length&&(a=null);let i={};for(const e in r)i[e]=0;return{...e,activePlayers:r,_activePlayersMoveLimit:a,_activePlayersNumMoves:i,_prevActivePlayers:n,_nextActivePlayers:o}}function je(e,t,n,r){"object"==typeof r&&r!==Ce.NULL||(r={stage:r}),void 0!==r.stage&&(e[n]=r.stage,r.moveLimit&&(t[n]=r.moveLimit))}function Se(e,t){return e[t]+""}const Ae={first:(e,t)=>0===t.turn?t.playOrderPos:(t.playOrderPos+1)%t.playOrder.length,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length},Ce={NULL:null};function Me({moves:e,phases:t,endIf:n,onEnd:r,turn:o,events:a,plugins:i,disableUndo:s}){void 0===e&&(e={}),void 0===a&&(a={}),void 0===i&&(i=[]),void 0===t&&(t={}),n||(n=()=>{}),r||(r=e=>e),o||(o={});const l={...t};""in l&&_e("cannot specify phase with empty name"),l[""]={};let c={},u=new Set,d=null;Object.keys(e).forEach(e=>u.add(e));const f=e=>{const t=we(e,i);return e=>{const n=$e(e);return t(e.G,n)}},v=e=>t=>{let n=$e(t);return e(t.G,n)},h={onEnd:f(r),endIf:v(n)};for(let e in l){const t=l[e];if(!0===t.start&&(d=e),void 0!==t.moves)for(let n of Object.keys(t.moves))c[e+"."+n]=t.moves[n],u.add(n);void 0===t.endIf&&(t.endIf=()=>{}),void 0===t.onBegin&&(t.onBegin=e=>e),void 0===t.onEnd&&(t.onEnd=e=>e),void 0===t.turn&&(t.turn=o),void 0===t.turn.order&&(t.turn.order=Ae),void 0===t.turn.onBegin&&(t.turn.onBegin=e=>e),void 0===t.turn.onEnd&&(t.turn.onEnd=e=>e),void 0===t.turn.endIf&&(t.turn.endIf=()=>!1),void 0===t.turn.onMove&&(t.turn.onMove=e=>e),void 0===t.turn.stages&&(t.turn.stages={});for(const n in t.turn.stages){const r=t.turn.stages[n].moves||{};for(let t of Object.keys(r)){c[e+"."+n+"."+t]=r[t],u.add(t)}}t.wrapped={onBegin:f(t.onBegin),onEnd:f(t.onEnd),endIf:v(t.endIf)},t.turn.wrapped={onMove:f(t.turn.onMove),onBegin:f(t.turn.onBegin),onEnd:f(t.turn.onEnd),endIf:v(t.turn.endIf)}}function m(e){return e.phase?l[e.phase]:l[""]}function g(e){return e}function y(e,t){const n=new Set,r=new Set;for(let o=0;o<t.length;o++){const{fn:a,arg:i,...s}=t[o];if(a===D){r.clear();const t=e.ctx.phase;if(n.has(t)){const t={...e.ctx,phase:null};return{...e,ctx:t}}n.add(t)}let l=[];if(e=a(e,{...s,arg:i,next:l}),a===E)break;const c=k(e);if(c){t.push({fn:E,arg:c,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}const u=I(e);if(u)t.push({fn:D,arg:u,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});else{if(a===g){const n=_(e);if(n){t.push({fn:j,arg:n,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}}t.push(...l)}}return e}function b(e,{next:t}){return t.push({fn:x}),e}function x(e,{next:t}){let{G:n,ctx:r}=e;return n=m(r).wrapped.onBegin(e),t.push({fn:$}),{...e,G:n,ctx:r}}function $(e,{currentPlayer:t}){let{G:n,ctx:r}=e;const o=m(r);t?(r={...r,currentPlayer:t},o.turn.activePlayers&&(r=De(r,o.turn.activePlayers))):r=function(e,t){let{G:n,ctx:r}=e;const o=$e(e),a=t.order;let i=[...new Array(r.numPlayers)].map((e,t)=>t+"");void 0!==a.playOrder&&(i=a.playOrder(n,o));const s=a.first(n,o),l=typeof s;"number"!==l&&_e(`invalid value returned by turn.order.first — expected number got ${l} “${s}”.`);const c=Se(i,s);return r={...r,currentPlayer:c,playOrderPos:s,playOrder:i},r=De(r,t.activePlayers||{}),r}(e,o.turn);const a=r.turn+1;r={...r,turn:a,numMoves:0,_prevActivePlayers:[]},n=o.turn.wrapped.onBegin({...e,G:n,ctx:r});const i=s?[]:[{G:n,ctx:r}];return{...e,G:n,ctx:r,_undo:i,_redo:[]}}function w(e,{arg:t,next:n,phase:r}){const o=m({phase:r});let{ctx:a}=e;if(t&&t.next){if(!(t.next in l))return _e("invalid phase: "+t.next),e;a={...a,phase:t.next}}else a=void 0!==o.next?{...a,phase:o.next}:{...a,phase:null};return e={...e,ctx:a},n.push({fn:x}),e}function P(e,{arg:t,currentPlayer:n,next:r}){let{G:o,ctx:a}=e;const i=m(a),{endPhase:s,ctx:l}=function(e,t,n,r){const o=n.order;let{G:a,ctx:i}=e,s=i.playOrderPos,l=!1;if(r&&!0!==r)"object"!=typeof r&&_e(`invalid argument to endTurn: ${r}`),Object.keys(r).forEach(e=>{switch(e){case"remove":t=Se(i.playOrder,s);break;case"next":s=i.playOrder.indexOf(r.next),t=r.next;break;default:_e(`invalid argument to endTurn: ${e}`)}});else{const n=$e(e),r=o.next(a,n),c=typeof r;void 0!==r&&"number"!==c&&_e(`invalid value returned by turn.order.next — expected number or undefined got ${c} “${r}”.`),void 0===r?l=!0:(s=r,t=Se(i.playOrder,s))}return i={...i,playOrderPos:s,currentPlayer:t},{endPhase:l,ctx:i}}(e,n,i.turn,t);return a=l,e={...e,G:o,ctx:a},s?r.push({fn:D,turn:a.turn,phase:a.phase}):r.push({fn:$,currentPlayer:a.currentPlayer}),e}function O(e,{arg:t,playerID:n}){"string"==typeof t&&(t={stage:t});let{ctx:r}=e,{activePlayers:o,_activePlayersMoveLimit:a,_activePlayersNumMoves:i}=r;return t.stage&&(null===o&&(o={}),o[n]=t.stage,i[n]=0,t.moveLimit&&(null===a&&(a={}),a[n]=t.moveLimit)),r={...r,activePlayers:o,_activePlayersMoveLimit:a,_activePlayersNumMoves:i},{...e,ctx:r}}function k(e){return h.endIf(e)}function I(e){return m(e.ctx).wrapped.endIf(e)}function _(e){const t=m(e.ctx),n=e.ctx.numMoves||0;return!!(t.turn.moveLimit&&n>=t.turn.moveLimit)||t.turn.wrapped.endIf(e)}function E(e,{arg:t,phase:n}){e=D(e,{phase:n}),void 0===t&&(t=!0),e={...e,ctx:{...e.ctx,gameover:t}};const r=h.onEnd(e);return{...e,G:r}}function D(e,{arg:t,next:n,turn:r,automatic:o}){let a=(e=j(e,{turn:r,force:!0})).G,i=e.ctx;if(n&&n.push({fn:w,arg:t,phase:i.phase}),null===i.phase)return e;a=m(i).wrapped.onEnd(e),i={...i,phase:null};const s={action:p("endPhase",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};o&&(s.automatic=!0);const l=[...e.deltalog,s];return{...e,G:a,ctx:i,deltalog:l}}function j(e,{arg:t,next:n,turn:r,force:o,automatic:a,playerID:i}){if(r!==e.ctx.turn)return e;let{G:s,ctx:l}=e;const c=m(l),u=l.numMoves||0;if(!o&&c.turn.moveLimit&&u<c.turn.moveLimit)return d=`cannot end turn before making ${c.turn.moveLimit} moves`,ke(`INFO: ${d}`),e;var d;if(s=c.turn.wrapped.onEnd(e),n&&n.push({fn:P,arg:t,currentPlayer:l.currentPlayer}),l={...l,activePlayers:null},t&&t.remove){i=i||l.currentPlayer;const t=l.playOrder.filter(e=>e!=i),r=l.playOrderPos>t.length-1?0:l.playOrderPos;if(l={...l,playOrder:t,playOrderPos:r},0===t.length)return n.push({fn:D,turn:l.turn,phase:l.phase}),e}const f={action:p("endTurn",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};a&&(f.automatic=!0);const v=[...e.deltalog||[],f];return{...e,G:s,ctx:l,deltalog:v,_undo:[],_redo:[]}}function S(e,{arg:t,next:n,automatic:r,playerID:o}){o=o||e.ctx.currentPlayer;let{ctx:a}=e,{activePlayers:i,_activePlayersMoveLimit:s}=a;const l=null!==i&&o in i;if(!t&&l){const e=m(a).turn.stages[i[o]];e&&e.next&&(t=e.next)}if(n&&t&&n.push({fn:O,arg:t,playerID:o}),!l)return e;i=Object.keys(i).filter(e=>e!==o).reduce((e,t)=>(e[t]=i[t],e),{}),s&&(s=Object.keys(s).filter(e=>e!==o).reduce((e,t)=>(e[t]=s[t],e),{})),a=function(e){let{activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}=e;if(t&&0==Object.keys(t).length)if(e._nextActivePlayers)e=De(e,e._nextActivePlayers),({activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}=e);else if(o.length>0){const e=o.length-1;({activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r}=o[e]),o=o.slice(0,e)}else t=null,n=null;return{...e,activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}}({...a,activePlayers:i,_activePlayersMoveLimit:s});const c={action:p("endStage",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};r&&(c.automatic=!0);const u=[...e.deltalog||[],c];return{...e,ctx:a,deltalog:u}}function A(t,n,r){const o=m(t),a=o.turn.stages,{activePlayers:i}=t;if(i&&void 0!==i[r]&&i[r]!==Ce.NULL&&void 0!==a[i[r]]&&void 0!==a[i[r]].moves){const e=a[i[r]].moves;if(n in e)return e[n]}else if(o.moves){if(n in o.moves)return o.moves[n]}else if(n in e)return e[n];return null}const C={endStage:function(e,t){return y(e,[{fn:S,playerID:t}])},setStage:function(e,t,n){return y(e,[{fn:S,arg:n,playerID:t}])},endTurn:function(e,t,n){return y(e,[{fn:j,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},pass:function(e,t,n){return y(e,[{fn:j,turn:e.ctx.turn,phase:e.ctx.phase,force:!0,arg:n}])},endPhase:function(e){return y(e,[{fn:D,phase:e.ctx.phase,turn:e.ctx.turn}])},setPhase:function(e,t,n){return y(e,[{fn:D,phase:e.ctx.phase,turn:e.ctx.turn,arg:{next:n}}])},endGame:function(e,t,n){return y(e,[{fn:E,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},setActivePlayers:Ee};let M=[];return!1!==a.endTurn&&M.push("endTurn"),!1!==a.pass&&M.push("pass"),!1!==a.endPhase&&M.push("endPhase"),!1!==a.setPhase&&M.push("setPhase"),!1!==a.endGame&&M.push("endGame"),!1!==a.setActivePlayers&&M.push("setActivePlayers"),!1!==a.endStage&&M.push("endStage"),!1!==a.setStage&&M.push("setStage"),{ctx:e=>({numPlayers:e,turn:0,currentPlayer:"0",playOrder:[...new Array(e)].map((e,t)=>t+""),playOrderPos:0,phase:d,activePlayers:null}),init:e=>y(e,[{fn:b}]),isPlayerActive:function(e,t,n){return t.activePlayers?n in t.activePlayers:t.currentPlayer===n},eventHandlers:C,eventNames:Object.keys(C),enabledEventNames:M,moveMap:c,moveNames:[...u.values()],processMove:function(e,t){let n=m(e.ctx);const r=A(e.ctx,t.type,t.playerID),o=!r||"function"==typeof r||!0!==r.noLimit;let{ctx:a}=e,{_activePlayersNumMoves:i}=a;const{playerID:s}=t;let l=e.ctx.numMoves;o&&(s==e.ctx.currentPlayer&&l++,a.activePlayers&&i[s]++),e={...e,ctx:{...a,numMoves:l,_activePlayersNumMoves:i}},a._activePlayersMoveLimit&&i[s]>=a._activePlayersMoveLimit[s]&&(e=S(e,{playerID:s,automatic:!0}));const c=n.turn.wrapped.onMove(e);return y(e={...e,G:c},[{fn:g}])},processEvent:function(e,t){const{type:n,playerID:r,args:o}=t.payload;if(C.hasOwnProperty(n)){const t=[e,r].concat(o);return C[n].apply({},t)}return e},getMove:A}}function ze(e){if(function(e){return void 0!==e.processMove}(e))return e;if(void 0===e.name&&(e.name="default"),void 0===e.disableUndo&&(e.disableUndo=!1),void 0===e.setup&&(e.setup=()=>({})),void 0===e.moves&&(e.moves={}),void 0===e.playerView&&(e.playerView=e=>e),void 0===e.plugins&&(e.plugins=[]),e.plugins.forEach(e=>{if(void 0===e.name)throw new Error("Plugin missing name attribute");if(e.name.includes(" "))throw new Error(e.name+": Plugin name must not include spaces")}),e.name.includes(" "))throw new Error(e.name+": Game name must not include spaces");const t=Me(e);return{...e,flow:t,moveNames:t.moveNames,pluginNames:e.plugins.map(e=>e.name),processMove:(n,r)=>{let o=t.getMove(n.ctx,r.type,r.playerID);var a;if((a=o)instanceof Object&&void 0!==a.move&&(o=o.move),o instanceof Function){const t=we(o,e.plugins),a={...$e(n),playerID:r.playerID};let i=[];return void 0!==r.args&&(i=i.concat(r.args)),t(n.G,a,...i)}return _e(`invalid move object: ${r.type}`),n.G}}}function Ne(){}const Be=e=>e;function Ge(e,t){for(const n in t)e[n]=t[n];return e}function qe(e){return e()}function Le(){return Object.create(null)}function Te(e){e.forEach(qe)}function Re(e){return"function"==typeof e}function Ue(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function Ke(e,t,n){e.$$.on_destroy.push(function(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function Fe(e,t,n){return e[1]?Ge({},Ge(t.$$scope.ctx,e[1](n?n(t):{}))):t.$$scope.ctx}function Ve(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}const Je="undefined"!=typeof window;let He=Je?()=>window.performance.now():()=>Date.now(),We=Je?e=>requestAnimationFrame(e):Ne;const Ye=new Set;let Qe,Xe=!1;function Ze(){Ye.forEach(e=>{e[0](He())||(Ye.delete(e),e[1]())}),Xe=Ye.size>0,Xe&&We(Ze)}function et(e,t){e.appendChild(t)}function tt(e,t,n){e.insertBefore(t,n||null)}function nt(e){e.parentNode.removeChild(e)}function rt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function ot(e){return document.createElement(e)}function at(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function it(e){return document.createTextNode(e)}function st(){return it(" ")}function lt(){return it("")}function ct(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function ut(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function dt(e,t){t=""+t,e.data!==t&&(e.data=t)}function pt(e,t){(null!=t||e.value)&&(e.value=t)}function ft(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}}function vt(e,t,n){e.classList[n?"add":"remove"](t)}function ht(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}let mt,gt=0,yt={};function bt(e,t,n,r,o,a,i,s=0){const l=16.666/r;let c="{\n";for(let e=0;e<=1;e+=l){const r=t+(n-t)*a(e);c+=100*e+`%{${i(r,1-r)}}\n`}const u=c+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${s}`;if(!yt[d]){if(!Qe){const e=ot("style");document.head.appendChild(e),Qe=e.sheet}yt[d]=!0,Qe.insertRule(`@keyframes ${d} ${u}`,Qe.cssRules.length)}const p=e.style.animation||"";return e.style.animation=`${p?`${p}, `:""}${d} ${r}ms linear ${o}ms 1 both`,gt+=1,d}function xt(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--gt&&We(()=>{if(gt)return;let e=Qe.cssRules.length;for(;e--;)Qe.deleteRule(e);yt={}})}function $t(e){mt=e}function wt(){if(!mt)throw new Error("Function called outside component initialization");return mt}function Pt(e){wt().$$.on_destroy.push(e)}function Ot(){const e=mt;return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=ht(t,n);r.slice().forEach(t=>{t.call(e,o)})}}}function kt(e,t){wt().$$.context.set(e,t)}function It(e){return wt().$$.context.get(e)}const _t=[],Et=[],Dt=[],jt=[],St=Promise.resolve();let At,Ct=!1;function Mt(e){Dt.push(e)}function zt(){const e=new Set;do{for(;_t.length;){const e=_t.shift();$t(e),Nt(e.$$)}for(;Et.length;)Et.pop()();for(let t=0;t<Dt.length;t+=1){const n=Dt[t];e.has(n)||(n(),e.add(n))}Dt.length=0}while(_t.length);for(;jt.length;)jt.pop()();Ct=!1}function Nt(e){e.fragment&&(e.update(e.dirty),Te(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(Mt))}function Bt(e,t,n){e.dispatchEvent(ht(`${t?"intro":"outro"}${n}`))}const Gt=new Set;let qt;function Lt(){qt={r:0,c:[],p:qt}}function Tt(){qt.r||Te(qt.c),qt=qt.p}function Rt(e,t){e&&e.i&&(Gt.delete(e),e.i(t))}function Ut(e,t,n,r){if(e&&e.o){if(Gt.has(e))return;Gt.add(e),qt.c.push(()=>{Gt.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}const Kt={duration:0};function Ft(e,t,n,r){let o=t(e,n),a=r?0:1,i=null,s=null,l=null;function c(){l&&xt(e,l)}function u(e,t){const n=e.b-a;return t*=Math.abs(n),{a:a,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function d(t){const{delay:n=0,duration:r=300,easing:d=Be,tick:p=Ne,css:f}=o||Kt,v={start:He()+n,b:t};t||(v.group=qt,qt.r+=1),i?s=v:(f&&(c(),l=bt(e,a,t,r,n,d,f)),t&&p(0,1),i=u(v,r),Mt(()=>Bt(e,t,"start")),function(e){let t;Xe||(Xe=!0,We(Ze)),new Promise(n=>{Ye.add(t=[e,n])})}(t=>{if(s&&t>s.start&&(i=u(s,r),s=null,Bt(e,i.b,"start"),f&&(c(),l=bt(e,a,i.b,i.duration,0,d,o.css))),i)if(t>=i.end)p(a=i.b,1-a),Bt(e,i.b,"end"),s||(i.b?c():--i.group.r||Te(i.group.c)),i=null;else if(t>=i.start){const e=t-i.start;a=i.a+i.d*d(e/i.duration),p(a,1-a)}return!(!i&&!s)}))}return{run(e){Re(o)?(At||(At=Promise.resolve(),At.then(()=>{At=null})),At).then(()=>{o=o(),d(e)}):d(e)},end(){c(),i=s=null}}}const Vt="undefined"!=typeof window?window:global;function Jt(e,t,n){const{fragment:r,on_mount:o,on_destroy:a,after_update:i}=e.$$;r.m(t,n),Mt(()=>{const t=o.map(qe).filter(Re);a?a.push(...t):Te(t),e.$$.on_mount=[]}),i.forEach(Mt)}function Ht(e,t){e.$$.fragment&&(Te(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function Wt(e,t){e.$$.dirty||(_t.push(e),Ct||(Ct=!0,St.then(zt)),e.$$.dirty=Le()),e.$$.dirty[t]=!0}function Yt(e,t,n,r,o,a){const i=mt;$t(e);const s=t.props||{},l=e.$$={fragment:null,ctx:null,props:a,update:Ne,not_equal:o,bound:Le(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:Le(),dirty:null};let c=!1;l.ctx=n?n(e,s,(t,n,r=n)=>(l.ctx&&o(l.ctx[t],l.ctx[t]=r)&&(l.bound[t]&&l.bound[t](r),c&&Wt(e,t)),n)):s,l.update(),c=!0,Te(l.before_update),l.fragment=r(l.ctx),t.target&&(t.hydrate?l.fragment.l(function(e){return Array.from(e.childNodes)}(t.target)):l.fragment.c(),t.intro&&Rt(e.$$.fragment),Jt(e,t.target,t.anchor),zt()),$t(i)}class Qt{$destroy(){Ht(this,1),this.$destroy=Ne}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}const Xt=[];function Zt(e,t=Ne){let n;const r=[];function o(t){if(Ue(e,t)&&(e=t,n)){const t=!Xt.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),Xt.push(n,e)}if(t){for(let e=0;e<Xt.length;e+=2)Xt[e][0](Xt[e+1]);Xt.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(a,i=Ne){const s=[a,i];return r.push(s),1===r.length&&(n=t(o)||Ne),a(e),()=>{const e=r.indexOf(s);-1!==e&&r.splice(e,1),0===r.length&&(n(),n=null)}}}}function en(e){const t=e-1;return t*t*t+1}function tn(e,{delay:t=0,duration:n=400,easing:r=en,x:o=0,y:a=0,opacity:i=0}){const s=getComputedStyle(e),l=+s.opacity,c="none"===s.transform?"":s.transform,u=l*(1-i);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${c} translate(${(1-e)*o}px, ${(1-e)*a}px);\n\t\t\topacity: ${l-u*t}`}}function nn(e,t,n){const r=Object.create(e);return r.key=t[n][0],r.label=t[n][1].label,r}function rn(e){var t,n,r,o,a=e.label+"";function i(){return e.click_handler(e)}return{c(){t=ot("div"),n=it(a),r=st(),ut(t,"class","menu-item svelte-19bfq8g"),vt(t,"active",e.pane==e.key),o=ct(t,"click",i)},m(e,o){tt(e,t,o),et(t,n),et(t,r)},p(r,o){e=o,r.panes&&a!==(a=e.label+"")&&dt(n,a),(r.pane||r.panes)&&vt(t,"active",e.pane==e.key)},d(e){e&&nt(t),o()}}}function on(e){var t;let n=Object.entries(e.panes).reverse(),r=[];for(let t=0;t<n.length;t+=1)r[t]=rn(nn(e,n,t));return{c(){t=ot("div");for(let e=0;e<r.length;e+=1)r[e].c();ut(t,"class","menu svelte-19bfq8g")},m(e,n){tt(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(e.pane||e.panes){let a;for(n=Object.entries(o.panes).reverse(),a=0;a<n.length;a+=1){const i=nn(o,n,a);r[a]?r[a].p(e,i):(r[a]=rn(i),r[a].c(),r[a].m(t,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},i:Ne,o:Ne,d(e){e&&nt(t),rt(r,e)}}}function an(e,t,n){let{pane:r,panes:o}=t;const a=Ot();return e.$set=e=>{"pane"in e&&n("pane",r=e.pane),"panes"in e&&n("panes",o=e.panes)},{pane:r,panes:o,dispatch:a,click_handler:({key:e})=>a("change",e)}}class sn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-19bfq8g-style")||((t=ot("style")).id="svelte-19bfq8g-style",t.textContent=".menu.svelte-19bfq8g{display:flex;margin-top:-10px;flex-direction:row;border:1px solid #ccc;border-radius:5px 5px 0 0;height:25px;line-height:25px;margin-right:-500px;transform-origin:bottom right;transform:rotate(-90deg) translate(0, -500px)}.menu-item.svelte-19bfq8g{line-height:25px;cursor:pointer;background:#fefefe;color:#555;padding-left:15px;padding-right:15px;text-align:center}.menu-item.svelte-19bfq8g:last-child{border-radius:0 5px 0 0}.menu-item.svelte-19bfq8g:first-child{border-radius:5px 0 0 0}.menu-item.active.svelte-19bfq8g{cursor:default;font-weight:bold;background:#ddd;color:#555}.menu-item.svelte-19bfq8g:hover{background:#ddd;color:#555}",et(document.head,t)),Yt(this,e,an,on,Ue,["pane","panes"])}}function ln(e){var t,n;return{c(){t=ot("div"),n=it(e.label),ut(t,"class","label svelte-1olzq4i")},m(e,r){tt(e,t,r),et(t,n)},p(e,t){e.label&&dt(n,t.label)},d(e){e&&nt(t)}}}function cn(e){var t,n,r,o,a,i=e.label&&ln(e);return{c(){t=ot("div"),n=ot("div"),r=it(e.value),o=st(),i&&i.c(),ut(n,"class","key-box svelte-1olzq4i"),ut(t,"class","key svelte-1olzq4i"),vt(t,"active",e.active),a=[ct(window,"keydown",e.Keypress),ct(n,"click",e.Activate)]},m(e,a){tt(e,t,a),et(t,n),et(n,r),et(t,o),i&&i.m(t,null)},p(e,n){e.value&&dt(r,n.value),n.label?i?i.p(e,n):((i=ln(n)).c(),i.m(t,null)):i&&(i.d(1),i=null),e.active&&vt(t,"active",n.active)},i:Ne,o:Ne,d(e){e&&nt(t),i&&i.d(),Te(a)}}}function un(e,t,n){let r,{value:o,onPress:a=null,label:i=null,disable:s=!1}=t;const{disableHotkeys:l}=It("hotkeys");Ke(e,l,e=>{r=e,n("$disableHotkeys",r)});let c=!1;function u(){n("active",c=!1)}function d(){n("active",c=!0),setTimeout(u,200),a&&setTimeout(a,1)}return e.$set=e=>{"value"in e&&n("value",o=e.value),"onPress"in e&&n("onPress",a=e.onPress),"label"in e&&n("label",i=e.label),"disable"in e&&n("disable",s=e.disable)},{value:o,onPress:a,label:i,disable:s,disableHotkeys:l,active:c,Activate:d,Keypress:function(e){r||s||e.ctrlKey||e.metaKey||e.key!=o||(e.preventDefault(),d())}}}class dn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-1olzq4i-style")||((t=ot("style")).id="svelte-1olzq4i-style",t.textContent=".key.svelte-1olzq4i{display:flex;flex-direction:row;align-items:center}.key-box.svelte-1olzq4i{cursor:pointer;min-width:10px;padding-left:5px;padding-right:5px;height:20px;line-height:20px;text-align:center;border:1px solid #ccc;box-shadow:1px 1px 1px #888;background:#eee;color:#444}.key-box.svelte-1olzq4i:hover{background:#ddd}.key.active.svelte-1olzq4i .key-box.svelte-1olzq4i{background:#ddd;border:1px solid #999;box-shadow:none}.label.svelte-1olzq4i{margin-left:10px}",et(document.head,t)),Yt(this,e,un,cn,Ue,["value","onPress","label","disable"])}}function pn(e){var t,n,r,o,a,i,s,l,c,u;return{c(){var d;t=ot("div"),n=ot("span"),r=it(e.name),o=st(),(a=ot("span")).textContent="(",i=st(),s=ot("span"),l=st(),(c=ot("span")).textContent=")",ut(s,"class","arg-field svelte-1mppqmp"),ut(s,"contenteditable",""),ut(t,"class","move svelte-1mppqmp"),vt(t,"active",e.active),u=[ct(s,"blur",e.Deactivate),ct(s,"keypress",(d=fn,function(e){return e.stopPropagation(),d.call(this,e)})),ct(s,"keydown",e.OnKeyDown),ct(t,"click",e.Activate)]},m(u,d){tt(u,t,d),et(t,n),et(n,r),et(t,o),et(t,a),et(t,i),et(t,s),e.span2_binding(s),et(t,l),et(t,c)},p(e,n){e.name&&dt(r,n.name),e.active&&vt(t,"active",n.active)},i:Ne,o:Ne,d(n){n&&nt(t),e.span2_binding(null),Te(u)}}}const fn=()=>{};function vn(e,t,n){let r,{Activate:o,Deactivate:a,name:i,active:s}=t;const l=Ot();var c;return c=()=>{s?r.focus():r.blur()},wt().$$.after_update.push(c),e.$set=e=>{"Activate"in e&&n("Activate",o=e.Activate),"Deactivate"in e&&n("Deactivate",a=e.Deactivate),"name"in e&&n("name",i=e.name),"active"in e&&n("active",s=e.active)},{Activate:o,Deactivate:a,name:i,active:s,span:r,OnKeyDown:function(e){"Enter"==e.key&&(e.preventDefault(),function(){try{const e=r.innerText;let t=new Function(`return [${e}]`)();l("submit",t)}catch(e){l("error",e)}n("span",r.innerText="",r)}()),"Escape"==e.key&&(e.preventDefault(),a())},span2_binding:function(e){Et[e?"unshift":"push"](()=>{n("span",r=e)})}}}class hn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-1mppqmp-style")||((t=ot("style")).id="svelte-1mppqmp-style",t.textContent=".move.svelte-1mppqmp{display:flex;flex-direction:row;cursor:pointer;margin-left:10px;color:#666}.move.svelte-1mppqmp:hover{color:#333}.move.active.svelte-1mppqmp{color:#111;font-weight:bold}.arg-field.svelte-1mppqmp{outline:none;font-family:monospace}",et(document.head,t)),Yt(this,e,vn,pn,Ue,["Activate","Deactivate","name","active"])}}function mn(e){var t,n;return{c(){t=ot("span"),n=it(e.error),ut(t,"class","move-error svelte-smqssc")},m(e,r){tt(e,t,r),et(t,n)},p(e,t){e.error&&dt(n,t.error)},d(e){e&&nt(t)}}}function gn(e){var t,n,r,o,a,i=new dn({props:{value:e.shortcut,onPress:e.Activate}}),s=new hn({props:{Activate:e.Activate,Deactivate:e.Deactivate,name:e.name,active:e.active}});s.$on("submit",e.Submit),s.$on("error",e.Error);var l=e.error&&mn(e);return{c(){t=ot("div"),n=ot("div"),i.$$.fragment.c(),r=st(),s.$$.fragment.c(),o=st(),l&&l.c(),ut(n,"class","wrapper svelte-smqssc")},m(e,c){tt(e,t,c),et(t,n),Jt(i,n,null),et(n,r),Jt(s,n,null),et(t,o),l&&l.m(t,null),a=!0},p(e,n){var r={};e.shortcut&&(r.value=n.shortcut),i.$set(r);var o={};e.name&&(o.name=n.name),e.active&&(o.active=n.active),s.$set(o),n.error?l?l.p(e,n):((l=mn(n)).c(),l.m(t,null)):l&&(l.d(1),l=null)},i(e){a||(Rt(i.$$.fragment,e),Rt(s.$$.fragment,e),a=!0)},o(e){Ut(i.$$.fragment,e),Ut(s.$$.fragment,e),a=!1},d(e){e&&nt(t),Ht(i),Ht(s),l&&l.d()}}}function yn(e,t,n){let{shortcut:r,name:o,fn:a}=t;const{disableHotkeys:i}=It("hotkeys");let s="",l=!1;function c(){i.set(!1),n("error",s=""),n("active",l=!1)}return e.$set=e=>{"shortcut"in e&&n("shortcut",r=e.shortcut),"name"in e&&n("name",o=e.name),"fn"in e&&n("fn",a=e.fn)},{shortcut:r,name:o,fn:a,error:s,active:l,Activate:function(){i.set(!0),n("active",l=!0)},Deactivate:c,Submit:function(e){n("error",s=""),c(),a.apply(this,e.detail)},Error:function(e){n("error",s=e.detail),_e(e.detail)}}}class bn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-smqssc-style")||((t=ot("style")).id="svelte-smqssc-style",t.textContent=".move-error.svelte-smqssc{color:#a00;font-weight:bold}.wrapper.svelte-smqssc{display:flex;flex-direction:row;align-items:center}",et(document.head,t)),Yt(this,e,yn,gn,Ue,["shortcut","name","fn"])}}var xn=function(e,t){return{parse:function(t){var n=JSON.parse(t,o).map(r),a=n[0];return"object"==typeof a&&a?function t(n,r,o){return Object.keys(o).reduce((function(o,a){var i=o[a];if(i instanceof e){var s=n[i];"object"!=typeof s||r.has(s)?o[a]=s:(r.add(s),o[a]=t(n,r,s))}return o}),o)}(n,new Set,a):a},stringify:function(e){for(var t,r=new Map,o=[],a=[],i=+n(r,o,e),s=function(e,a){if(t)return t=!t,a;switch(typeof a){case"object":if(null===a)return a;case"string":return r.get(a)||n(r,o,a)}return a};i<o.length;i++)t=!0,a[i]=JSON.stringify(o[i],s);return"["+a.join(",")+"]"}};function n(t,n,r){var o=e(n.push(r)-1);return t.set(r,o),o}function r(t){return t instanceof e?e(t):t}function o(t,n){return"string"==typeof n?new e(n):n}}(String);const $n=xn.parse,wn=xn.stringify;function Pn(e){var t,n,r,o,a,i,s,l,c,u=new dn({props:{value:"1",onPress:e.client.reset,label:"reset"}}),d=new dn({props:{value:"2",onPress:e.Save,label:"save"}}),p=new dn({props:{value:"3",onPress:e.Restore,label:"restore"}}),f=new dn({props:{value:".",disable:!0,label:"hide"}});return{c(){t=ot("section"),n=ot("li"),u.$$.fragment.c(),r=st(),o=ot("li"),d.$$.fragment.c(),a=st(),i=ot("li"),p.$$.fragment.c(),s=st(),l=ot("li"),f.$$.fragment.c(),ut(n,"class","svelte-1x2w9i0"),ut(o,"class","svelte-1x2w9i0"),ut(i,"class","svelte-1x2w9i0"),ut(l,"class","svelte-1x2w9i0"),ut(t,"id","debug-controls"),ut(t,"class","controls")},m(e,v){tt(e,t,v),et(t,n),Jt(u,n,null),et(t,r),et(t,o),Jt(d,o,null),et(t,a),et(t,i),Jt(p,i,null),et(t,s),et(t,l),Jt(f,l,null),c=!0},p(e,t){var n={};e.client&&(n.onPress=t.client.reset),u.$set(n)},i(e){c||(Rt(u.$$.fragment,e),Rt(d.$$.fragment,e),Rt(p.$$.fragment,e),Rt(f.$$.fragment,e),c=!0)},o(e){Ut(u.$$.fragment,e),Ut(d.$$.fragment,e),Ut(p.$$.fragment,e),Ut(f.$$.fragment,e),c=!1},d(e){e&&nt(t),Ht(u),Ht(d),Ht(p),Ht(f)}}}function On(e,t,n){let{client:r}=t;return e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,Save:function(){const e=r.getState(),t=wn({...e,_undo:[],_redo:[],deltalog:[]});window.localStorage.setItem("gamestate",t),window.localStorage.setItem("initialState",wn(r.initialState))},Restore:function(){const e=window.localStorage.getItem("gamestate"),t=window.localStorage.getItem("initialState");if(null!==e&&null!==t){const n=$n(e),o=$n(t);r.store.dispatch(v({state:n,initialState:o}))}}}}class kn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-1x2w9i0-style")||((t=ot("style")).id="svelte-1x2w9i0-style",t.textContent="li.svelte-1x2w9i0{list-style:none;margin:none;margin-bottom:5px}",et(document.head,t)),Yt(this,e,On,Pn,Ue,["client"])}}function In(e,t,n){const r=Object.create(e);return r.player=t[n],r}function _n(e){var t,n,r,o,a=e.player+"";function i(){return e.click_handler(e)}return{c(){t=ot("div"),n=it(a),r=st(),ut(t,"class","player svelte-6sf87x"),vt(t,"current",e.player==e.ctx.currentPlayer),vt(t,"active",e.player==e.playerID),o=ct(t,"click",i)},m(e,o){tt(e,t,o),et(t,n),et(t,r)},p(r,o){e=o,r.players&&a!==(a=e.player+"")&&dt(n,a),(r.players||r.ctx)&&vt(t,"current",e.player==e.ctx.currentPlayer),(r.players||r.playerID)&&vt(t,"active",e.player==e.playerID)},d(e){e&&nt(t),o()}}}function En(e){var t;let n=e.players,r=[];for(let t=0;t<n.length;t+=1)r[t]=_n(In(e,n,t));return{c(){t=ot("div");for(let e=0;e<r.length;e+=1)r[e].c();ut(t,"class","player-box svelte-6sf87x")},m(e,n){tt(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(e.players||e.ctx||e.playerID){let a;for(n=o.players,a=0;a<n.length;a+=1){const i=In(o,n,a);r[a]?r[a].p(e,i):(r[a]=_n(i),r[a].c(),r[a].m(t,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},i:Ne,o:Ne,d(e){e&&nt(t),rt(r,e)}}}function Dn(e,t,n){let{ctx:r,playerID:o}=t;const a=Ot();function i(e){a("change",e==o?{playerID:null}:{playerID:e})}let s;return e.$set=e=>{"ctx"in e&&n("ctx",r=e.ctx),"playerID"in e&&n("playerID",o=e.playerID)},e.$$.update=(e={ctx:1})=>{e.ctx&&n("players",s=r?[...Array(r.numPlayers).keys()].map(e=>e.toString()):[])},{ctx:r,playerID:o,OnClick:i,players:s,click_handler:({player:e})=>i(e)}}class jn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-6sf87x-style")||((t=ot("style")).id="svelte-6sf87x-style",t.textContent=".player-box.svelte-6sf87x{display:flex;flex-direction:row}.player.svelte-6sf87x{cursor:pointer;text-align:center;width:30px;height:30px;line-height:30px;background:#eee;border:3px solid #fefefe;box-sizing:content-box}.player.current.svelte-6sf87x{background:#555;color:#eee;font-weight:bold}.player.active.svelte-6sf87x{border:3px solid #ff7f50}",et(document.head,t)),Yt(this,e,Dn,En,Ue,["ctx","playerID"])}}function Sn(e,t,n){const r=Object.create(e);return r.name=t[n][0],r.fn=t[n][1],r}function An(e){var t,n,r,o=new bn({props:{shortcut:e.shortcuts[e.name],fn:e.fn,name:e.name}});return{c(){t=ot("li"),o.$$.fragment.c(),n=st(),ut(t,"class","svelte-1vg2l2b")},m(e,a){tt(e,t,a),Jt(o,t,null),et(t,n),r=!0},p(e,t){var n={};e.client&&(n.shortcut=t.shortcuts[t.name]),e.client&&(n.fn=t.fn),e.client&&(n.name=t.name),o.$set(n)},i(e){r||(Rt(o.$$.fragment,e),r=!0)},o(e){Ut(o.$$.fragment,e),r=!1},d(e){e&&nt(t),Ht(o)}}}function Cn(e){var t,n;return{c(){(t=ot("button")).textContent="End Turn",ut(t,"class","svelte-1vg2l2b"),n=ct(t,"click",e.click_handler)},m(e,n){tt(e,t,n)},d(e){e&&nt(t),n()}}}function Mn(e){var t,n;return{c(){(t=ot("button")).textContent="End Phase",ut(t,"class","svelte-1vg2l2b"),n=ct(t,"click",e.click_handler_1)},m(e,n){tt(e,t,n)},d(e){e&&nt(t),n()}}}function zn(e){var t,n;return{c(){(t=ot("button")).textContent="End Stage",ut(t,"class","svelte-1vg2l2b"),n=ct(t,"click",e.click_handler_2)},m(e,n){tt(e,t,n)},d(e){e&&nt(t),n()}}}function Nn(e){var t,n,r,o,a,i,s,l,c,u,d,p,f,v,h,m,g,y,b,x,$,w,P,O,k,I,_,E,D,j,S,A=JSON.stringify(e.G,null,2)+"",C=JSON.stringify(Bn(e.ctx),null,2)+"",M=new kn({props:{client:e.client}}),z=new jn({props:{ctx:e.ctx,playerID:e.playerID}});z.$on("change",e.change_handler);let N=Object.entries(e.client.moves),B=[];for(let t=0;t<N.length;t+=1)B[t]=An(Sn(e,N,t));const G=e=>Ut(B[e],1,1,()=>{B[e]=null});var q=e.client.events.endTurn&&Cn(e),L=e.ctx.phase&&e.client.events.endPhase&&Mn(e),T=e.ctx.activePlayers&&e.client.events.endStage&&zn(e);return{c(){t=ot("section"),(n=ot("h3")).textContent="Controls",r=st(),M.$$.fragment.c(),o=st(),a=ot("section"),(i=ot("h3")).textContent="Players",s=st(),z.$$.fragment.c(),l=st(),c=ot("section"),(u=ot("h3")).textContent="Moves",d=st();for(let e=0;e<B.length;e+=1)B[e].c();p=st(),f=ot("section"),(v=ot("h3")).textContent="Events",h=st(),m=ot("div"),q&&q.c(),g=st(),L&&L.c(),y=st(),T&&T.c(),b=st(),x=ot("section"),($=ot("label")).textContent="G",w=st(),P=ot("pre"),O=it(A),k=st(),I=ot("section"),(_=ot("label")).textContent="ctx",E=st(),D=ot("pre"),j=it(C),ut(n,"class","svelte-1vg2l2b"),ut(i,"class","svelte-1vg2l2b"),ut(u,"class","svelte-1vg2l2b"),ut(v,"class","svelte-1vg2l2b"),ut(m,"class","events svelte-1vg2l2b"),ut($,"class","svelte-1vg2l2b"),ut(P,"class","json svelte-1vg2l2b"),ut(_,"class","svelte-1vg2l2b"),ut(D,"class","json svelte-1vg2l2b")},m(e,A){tt(e,t,A),et(t,n),et(t,r),Jt(M,t,null),tt(e,o,A),tt(e,a,A),et(a,i),et(a,s),Jt(z,a,null),tt(e,l,A),tt(e,c,A),et(c,u),et(c,d);for(let e=0;e<B.length;e+=1)B[e].m(c,null);tt(e,p,A),tt(e,f,A),et(f,v),et(f,h),et(f,m),q&&q.m(m,null),et(m,g),L&&L.m(m,null),et(m,y),T&&T.m(m,null),tt(e,b,A),tt(e,x,A),et(x,$),et(x,w),et(x,P),et(P,O),tt(e,k,A),tt(e,I,A),et(I,_),et(I,E),et(I,D),et(D,j),S=!0},p(e,t){var n={};e.client&&(n.client=t.client),M.$set(n);var r={};if(e.ctx&&(r.ctx=t.ctx),e.playerID&&(r.playerID=t.playerID),z.$set(r),e.shortcuts||e.client){let n;for(N=Object.entries(t.client.moves),n=0;n<N.length;n+=1){const r=Sn(t,N,n);B[n]?(B[n].p(e,r),Rt(B[n],1)):(B[n]=An(r),B[n].c(),Rt(B[n],1),B[n].m(c,null))}for(Lt(),n=N.length;n<B.length;n+=1)G(n);Tt()}t.client.events.endTurn?q||((q=Cn(t)).c(),q.m(m,g)):q&&(q.d(1),q=null),t.ctx.phase&&t.client.events.endPhase?L||((L=Mn(t)).c(),L.m(m,y)):L&&(L.d(1),L=null),t.ctx.activePlayers&&t.client.events.endStage?T||((T=zn(t)).c(),T.m(m,null)):T&&(T.d(1),T=null),S&&!e.G||A===(A=JSON.stringify(t.G,null,2)+"")||dt(O,A),S&&!e.ctx||C===(C=JSON.stringify(Bn(t.ctx),null,2)+"")||dt(j,C)},i(e){if(!S){Rt(M.$$.fragment,e),Rt(z.$$.fragment,e);for(let e=0;e<N.length;e+=1)Rt(B[e]);S=!0}},o(e){Ut(M.$$.fragment,e),Ut(z.$$.fragment,e),B=B.filter(Boolean);for(let e=0;e<B.length;e+=1)Ut(B[e]);S=!1},d(e){e&&nt(t),Ht(M),e&&(nt(o),nt(a)),Ht(z),e&&(nt(l),nt(c)),rt(B,e),e&&(nt(p),nt(f)),q&&q.d(),L&&L.d(),T&&T.d(),e&&(nt(b),nt(x),nt(k),nt(I))}}}function Bn(e){let t={};for(const n in e)n.startsWith("_")||(t[n]=e[n]);return t}function Gn(e,t,n){let{client:r}=t;const o=function(e,t,n){var r={},o={};for(var a in e)o[a]=a;for(var i in t)o[i]=i;for(var s={},l=0;l<n.length;l++){s[n[l]]=!0}var c=s,u=!0;for(var d in o){var p=d[0];if(c[p]){u=!1;break}c[p]=!0,r[d]=p}if(u)return r;c=s;var f=97;for(var v in r={},o){for(var h=String.fromCharCode(f);c[h];)f++,h=String.fromCharCode(f);c[h]=!0,r[v]=h}return r}(r.moves,r.events,"mlia");let a=r.playerID,i={},s={};r.subscribe(e=>{e&&(n("G",s=e.G),n("ctx",i=e.ctx)),n("playerID",a=r.playerID)});return e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,shortcuts:o,playerID:a,ctx:i,G:s,change_handler:e=>r.updatePlayerID(e.detail.playerID),click_handler:()=>r.events.endTurn(),click_handler_1:()=>r.events.endPhase(),click_handler_2:()=>r.events.endStage()}}class qn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-1vg2l2b-style")||((t=ot("style")).id="svelte-1vg2l2b-style",t.textContent=".json.svelte-1vg2l2b{font-family:monospace;color:#888}label.svelte-1vg2l2b{font-weight:bold;font-size:1.1em;display:inline}h3.svelte-1vg2l2b{text-transform:uppercase}li.svelte-1vg2l2b{list-style:none;margin:none;margin-bottom:5px}.events.svelte-1vg2l2b{display:flex;flex-direction:column}.events.svelte-1vg2l2b button.svelte-1vg2l2b{width:100px}.events.svelte-1vg2l2b button.svelte-1vg2l2b:not(:last-child){margin-bottom:10px}",et(document.head,t)),Yt(this,e,Gn,Nn,Ue,["client"])}}function Ln(e){var t,n,r,o,a,i,s=JSON.stringify(e.value)+"";return{c(){t=ot("div"),n=ot("strong"),r=it(e.name),o=st(),a=ot("div"),i=it(s),ut(a,"class","svelte-13qih23"),ut(t,"class","item svelte-13qih23")},m(e,s){tt(e,t,s),et(t,n),et(n,r),et(t,o),et(t,a),et(a,i)},p(e,t){e.name&&dt(r,t.name),e.value&&s!==(s=JSON.stringify(t.value)+"")&&dt(i,s)},i:Ne,o:Ne,d(e){e&&nt(t)}}}function Tn(e,t,n){let{name:r,value:o}=t;return e.$set=e=>{"name"in e&&n("name",r=e.name),"value"in e&&n("value",o=e.value)},{name:r,value:o}}class Rn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-13qih23-style")||((t=ot("style")).id="svelte-13qih23-style",t.textContent=".item.svelte-13qih23{padding:10px}.item.svelte-13qih23:not(:first-child){border-top:1px dashed #aaa}.item.svelte-13qih23 div.svelte-13qih23{float:right;text-align:right}",et(document.head,t)),Yt(this,e,Tn,Ln,Ue,["name","value"])}}function Un(e){var t,n,r,o=new Rn({props:{name:"isConnected",value:e.$client.isConnected}}),a=new Rn({props:{name:"isMultiplayer",value:e.$client.isMultiplayer}});return{c(){t=ot("span"),o.$$.fragment.c(),n=st(),a.$$.fragment.c()},m(e,i){tt(e,t,i),Jt(o,t,null),et(t,n),Jt(a,t,null),r=!0},p(e,t){var n={};e.$client&&(n.value=t.$client.isConnected),o.$set(n);var r={};e.$client&&(r.value=t.$client.isMultiplayer),a.$set(r)},i(e){r||(Rt(o.$$.fragment,e),Rt(a.$$.fragment,e),r=!0)},o(e){Ut(o.$$.fragment,e),Ut(a.$$.fragment,e),r=!1},d(e){e&&nt(t),Ht(o),Ht(a)}}}function Kn(e){var t,n,r,o,a,i=new Rn({props:{name:"gameID",value:e.client.gameID}}),s=new Rn({props:{name:"playerID",value:e.client.playerID}}),l=new Rn({props:{name:"isActive",value:e.$client.isActive}}),c=e.$client.isMultiplayer&&Un(e);return{c(){t=ot("section"),i.$$.fragment.c(),n=st(),s.$$.fragment.c(),r=st(),l.$$.fragment.c(),o=st(),c&&c.c(),ut(t,"class","gameinfo svelte-1yzq5o8")},m(e,u){tt(e,t,u),Jt(i,t,null),et(t,n),Jt(s,t,null),et(t,r),Jt(l,t,null),et(t,o),c&&c.m(t,null),a=!0},p(e,n){var r={};e.client&&(r.value=n.client.gameID),i.$set(r);var o={};e.client&&(o.value=n.client.playerID),s.$set(o);var a={};e.$client&&(a.value=n.$client.isActive),l.$set(a),n.$client.isMultiplayer?c?(c.p(e,n),Rt(c,1)):((c=Un(n)).c(),Rt(c,1),c.m(t,null)):c&&(Lt(),Ut(c,1,1,()=>{c=null}),Tt())},i(e){a||(Rt(i.$$.fragment,e),Rt(s.$$.fragment,e),Rt(l.$$.fragment,e),Rt(c),a=!0)},o(e){Ut(i.$$.fragment,e),Ut(s.$$.fragment,e),Ut(l.$$.fragment,e),Ut(c),a=!1},d(e){e&&nt(t),Ht(i),Ht(s),Ht(l),c&&c.d()}}}function Fn(e,t,n){let r,{client:o}=t;return Ke(e,o,e=>{r=e,n("$client",r)}),e.$set=e=>{"client"in e&&n("client",o=e.client)},{client:o,$client:r}}class Vn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-1yzq5o8-style")||((t=ot("style")).id="svelte-1yzq5o8-style",t.textContent=".gameinfo.svelte-1yzq5o8{padding:10px}",et(document.head,t)),Yt(this,e,Fn,Kn,Ue,["client"])}}function Jn(e){var t,n;return{c(){t=ot("div"),n=it(e.turn),ut(t,"class","turn-marker svelte-6eza86"),ut(t,"style",e.style)},m(e,r){tt(e,t,r),et(t,n)},p(e,t){e.turn&&dt(n,t.turn)},i:Ne,o:Ne,d(e){e&&nt(t)}}}function Hn(e,t,n){let{turn:r,numEvents:o}=t;const a=`grid-row: span ${o}`;return e.$set=e=>{"turn"in e&&n("turn",r=e.turn),"numEvents"in e&&n("numEvents",o=e.numEvents)},{turn:r,numEvents:o,style:a}}class Wn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-6eza86-style")||((t=ot("style")).id="svelte-6eza86-style",t.textContent=".turn-marker.svelte-6eza86{display:flex;justify-content:center;align-items:center;grid-column:1;background:#555;color:#eee;text-align:center;font-weight:bold;border:1px solid #888}",et(document.head,t)),Yt(this,e,Hn,Jn,Ue,["turn","numEvents"])}}function Yn(e){var t,n,r=e.phase||"";return{c(){t=ot("div"),n=it(r),ut(t,"class","phase-marker svelte-1t4xap"),ut(t,"style",e.style)},m(e,r){tt(e,t,r),et(t,n)},p(e,t){e.phase&&r!==(r=t.phase||"")&&dt(n,r)},i:Ne,o:Ne,d(e){e&&nt(t)}}}function Qn(e,t,n){let{phase:r,numEvents:o}=t;const a=`grid-row: span ${o}`;return e.$set=e=>{"phase"in e&&n("phase",r=e.phase),"numEvents"in e&&n("numEvents",o=e.numEvents)},{phase:r,numEvents:o,style:a}}class Xn extends Qt{constructor(e){var t;super(),document.getElementById("svelte-1t4xap-style")||((t=ot("style")).id="svelte-1t4xap-style",t.textContent=".phase-marker.svelte-1t4xap{grid-column:3;background:#555;border:1px solid #888;color:#eee;text-align:center;font-weight:bold;padding-top:10px;padding-bottom:10px;text-orientation:sideways;writing-mode:vertical-rl;line-height:30px;width:100%}",et(document.head,t)),Yt(this,e,Qn,Yn,Ue,["phase","numEvents"])}}function Zn(e){var t,n;return{c(){t=ot("div"),n=it(e.custompayload)},m(e,r){tt(e,t,r),et(t,n)},p:Ne,i:Ne,o:Ne,d(e){e&&nt(t)}}}function er(e,t,n){let{payload:r}=t;const o=void 0!==r?JSON.stringify(r,null,4):"";return e.$set=e=>{"payload"in e&&n("payload",r=e.payload)},{payload:r,custompayload:o}}class tr extends Qt{constructor(e){super(),Yt(this,e,er,Zn,Ue,["payload"])}}function nr(e){var t,n=new tr({props:{payload:e.payload}});return{c(){n.$$.fragment.c()},m(e,r){Jt(n,e,r),t=!0},p(e,t){var r={};e.payload&&(r.payload=t.payload),n.$set(r)},i(e){t||(Rt(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Ht(n,e)}}}function rr(e){var t,n,r=e.payloadComponent;function o(e){return{props:{payload:e.payload}}}if(r)var a=new r(o(e));return{c(){a&&a.$$.fragment.c(),t=lt()},m(e,r){a&&Jt(a,e,r),tt(e,t,r),n=!0},p(e,n){var i={};if(e.payload&&(i.payload=n.payload),r!==(r=n.payloadComponent)){if(a){Lt();const e=a;Ut(e.$$.fragment,1,0,()=>{Ht(e,1)}),Tt()}r?((a=new r(o(n))).$$.fragment.c(),Rt(a.$$.fragment,1),Jt(a,t.parentNode,t)):a=null}else r&&a.$set(i)},i(e){n||(a&&Rt(a.$$.fragment,e),n=!0)},o(e){a&&Ut(a.$$.fragment,e),n=!1},d(e){e&&nt(t),a&&Ht(a,e)}}}function or(e){var t,n,r,o,a,i,s,l,c,u,d,p=e.action.payload.type+"",f=e.args.join(",")+"",v=[rr,nr],h=[];function m(e,t){return t.payloadComponent?0:1}return l=m(0,e),c=h[l]=v[l](e),{c(){t=ot("div"),n=ot("div"),r=it(p),o=it("("),a=it(f),i=it(")"),s=st(),c.c(),ut(t,"class","log-event player"+e.playerID+" svelte-10wdo7v"),vt(t,"pinned",e.pinned),d=[ct(t,"click",e.click_handler),ct(t,"mouseenter",e.mouseenter_handler),ct(t,"mouseleave",e.mouseleave_handler)]},m(e,c){tt(e,t,c),et(t,n),et(n,r),et(n,o),et(n,a),et(n,i),et(t,s),h[l].m(t,null),u=!0},p(e,n){u&&!e.action||p===(p=n.action.payload.type+"")||dt(r,p);var o=l;(l=m(0,n))===o?h[l].p(e,n):(Lt(),Ut(h[o],1,1,()=>{h[o]=null}),Tt(),(c=h[l])||(c=h[l]=v[l](n)).c(),Rt(c,1),c.m(t,null)),e.pinned&&vt(t,"pinned",n.pinned)},i(e){u||(Rt(c),u=!0)},o(e){Ut(c),u=!1},d(e){e&&nt(t),h[l].d(),Te(d)}}}function ar(e,t,n){let{logIndex:r,action:o,pinned:a,payload:i,payloadComponent:s}=t;const l=Ot(),c=o.payload.args||[],u=o.payload.playerID;return e.$set=e=>{"logIndex"in e&&n("logIndex",r=e.logIndex),"action"in e&&n("action",o=e.action),"pinned"in e&&n("pinned",a=e.pinned),"payload"in e&&n("payload",i=e.payload),"payloadComponent"in e&&n("payloadComponent",s=e.payloadComponent)},{logIndex:r,action:o,pinned:a,payload:i,payloadComponent:s,dispatch:l,args:c,playerID:u,click_handler:()=>l("click",{logIndex:r}),mouseenter_handler:()=>l("mouseenter",{logIndex:r}),mouseleave_handler:()=>l("mouseleave")}}class ir extends Qt{constructor(e){var t;super(),document.getElementById("svelte-10wdo7v-style")||((t=ot("style")).id="svelte-10wdo7v-style",t.textContent=".log-event.svelte-10wdo7v{grid-column:2;cursor:pointer;overflow:hidden;display:flex;flex-direction:column;justify-content:center;background:#fff;border:1px dotted #ccc;border-left:5px solid #ccc;padding:5px;text-align:center;color:#888;font-size:14px;min-height:25px;line-height:25px}.log-event.svelte-10wdo7v:hover{border-style:solid;background:#eee}.log-event.pinned.svelte-10wdo7v{border-style:solid;background:#eee;opacity:1}.player0.svelte-10wdo7v{border-left-color:#ff851b}.player1.svelte-10wdo7v{border-left-color:#7fdbff}.player2.svelte-10wdo7v{border-left-color:#0074d9}.player3.svelte-10wdo7v{border-left-color:#39cccc}.player4.svelte-10wdo7v{border-left-color:#3d9970}.player5.svelte-10wdo7v{border-left-color:#2ecc40}.player6.svelte-10wdo7v{border-left-color:#01ff70}.player7.svelte-10wdo7v{border-left-color:#ffdc00}.player8.svelte-10wdo7v{border-left-color:#001f3f}.player9.svelte-10wdo7v{border-left-color:#ff4136}.player10.svelte-10wdo7v{border-left-color:#85144b}.player11.svelte-10wdo7v{border-left-color:#f012be}.player12.svelte-10wdo7v{border-left-color:#b10dc9}.player13.svelte-10wdo7v{border-left-color:#111111}.player14.svelte-10wdo7v{border-left-color:#aaaaaa}.player15.svelte-10wdo7v{border-left-color:#dddddd}",et(document.head,t)),Yt(this,e,ar,or,Ue,["logIndex","action","pinned","payload","payloadComponent"])}}function sr(e){var t,n;return{c(){t=at("title"),n=it(e.title)},m(e,r){tt(e,t,r),et(t,n)},p(e,t){e.title&&dt(n,t.title)},d(e){e&&nt(t)}}}function lr(e){var t,n,r,o=e.title&&sr(e);const a=e.$$slots.default,i=function(e,t,n){if(e){const r=Fe(e,t,n);return e[0](r)}}(a,e,null);return{c(){t=at("svg"),o&&o.c(),n=lt(),i&&i.c(),ut(t,"xmlns","http://www.w3.org/2000/svg"),ut(t,"viewBox",e.viewBox),ut(t,"class","svelte-c8tyih")},l(e){i&&i.l(svg_nodes)},m(e,a){tt(e,t,a),o&&o.m(t,null),et(t,n),i&&i.m(t,null),r=!0},p(e,s){s.title?o?o.p(e,s):((o=sr(s)).c(),o.m(t,n)):o&&(o.d(1),o=null),i&&i.p&&e.$$scope&&i.p(function(e,t,n,r){return e[1]?Ge({},Ge(t.$$scope.changed||{},e[1](r?r(n):{}))):t.$$scope.changed||{}}(a,s,e,null),Fe(a,s,null)),r&&!e.viewBox||ut(t,"viewBox",s.viewBox)},i(e){r||(Rt(i,e),r=!0)},o(e){Ut(i,e),r=!1},d(e){e&&nt(t),o&&o.d(),i&&i.d(e)}}}function cr(e,t,n){let{title:r=null,viewBox:o}=t,{$$slots:a={},$$scope:i}=t;return e.$set=e=>{"title"in e&&n("title",r=e.title),"viewBox"in e&&n("viewBox",o=e.viewBox),"$$scope"in e&&n("$$scope",i=e.$$scope)},{title:r,viewBox:o,$$slots:a,$$scope:i}}class ur extends Qt{constructor(e){var t;super(),document.getElementById("svelte-c8tyih-style")||((t=ot("style")).id="svelte-c8tyih-style",t.textContent="svg.svelte-c8tyih{stroke:currentColor;fill:currentColor;stroke-width:0;width:100%;height:auto;max-height:100%}",et(document.head,t)),Yt(this,e,cr,lr,Ue,["title","viewBox"])}}function dr(e){var t;return{c(){ut(t=at("path"),"d","M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z")},m(e,n){tt(e,t,n)},d(e){e&&nt(t)}}}function pr(e){var t,n=[{viewBox:"0 0 512 512"},e.$$props];let r={$$slots:{default:[dr]},$$scope:{ctx:e}};for(var o=0;o<n.length;o+=1)r=Ge(r,n[o]);var a=new ur({props:r});return{c(){a.$$.fragment.c()},m(e,n){Jt(a,e,n),t=!0},p(e,t){var r,o=e.$$props?function(e,t){const n={},r={},o={$$scope:1};let a=e.length;for(;a--;){const i=e[a],s=t[a];if(s){for(const e in i)e in s||(r[e]=1);for(const e in s)o[e]||(n[e]=s[e],o[e]=1);e[a]=s}else for(const e in i)o[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}(n,[n[0],(r=t.$$props,"object"==typeof r&&null!==r?r:{})]):{};e.$$scope&&(o.$$scope={changed:e,ctx:t}),a.$set(o)},i(e){t||(Rt(a.$$.fragment,e),t=!0)},o(e){Ut(a.$$.fragment,e),t=!1},d(e){Ht(a,e)}}}function fr(e,t,n){return e.$set=e=>{n("$$props",t=Ge(Ge({},t),e))},{$$props:t,$$props:t=Ve(t)}}class vr extends Qt{constructor(e){super(),Yt(this,e,fr,pr,Ue,[])}}function hr(e){var t,n;return{c(){t=ot("div"),n=it(e.text),ut(t,"alt",e.text),ut(t,"class","svelte-1a7time")},m(e,r){tt(e,t,r),et(t,n)},p(e,r){e.text&&(dt(n,r.text),ut(t,"alt",r.text))},i:Ne,o:Ne,d(e){e&&nt(t)}}}function mr(e,t,n){let r,{action:o}=t;return e.$set=e=>{"action"in e&&n("action",o=e.action)},e.$$.update=(e={action:1})=>{if(e.action){const{type:e,args:t}=o.payload,a=(t||[]).join(",");n("text",r=`${e}(${a})`)}},{action:o,text:r}}class gr extends Qt{constructor(e){var t;super(),document.getElementById("svelte-1a7time-style")||((t=ot("style")).id="svelte-1a7time-style",t.textContent="div.svelte-1a7time{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;max-width:500px}",et(document.head,t)),Yt(this,e,mr,hr,Ue,["action"])}}function yr(e,t,n){const r=Object.create(e);return r.child=t[n],r.i=n,r}function br(e){var t,n,r,o,a,i,s,l,c,u,d,p=e.child.value+"",f=e.child.visits+"",v=new gr({props:{action:e.child.parentAction}});function h(){return e.click_handler(e)}function m(){return e.mouseout_handler(e)}function g(){return e.mouseover_handler(e)}return{c(){t=ot("tr"),n=ot("td"),r=it(p),o=st(),a=ot("td"),i=it(f),s=st(),l=ot("td"),v.$$.fragment.c(),c=st(),ut(n,"class","svelte-ztcwsu"),ut(a,"class","svelte-ztcwsu"),ut(l,"class","svelte-ztcwsu"),ut(t,"class","svelte-ztcwsu"),vt(t,"clickable",e.children.length>0),vt(t,"selected",e.i===e.selectedIndex),d=[ct(t,"click",h),ct(t,"mouseout",m),ct(t,"mouseover",g)]},m(e,d){tt(e,t,d),et(t,n),et(n,r),et(t,o),et(t,a),et(a,i),et(t,s),et(t,l),Jt(v,l,null),et(t,c),u=!0},p(n,o){e=o,u&&!n.children||p===(p=e.child.value+"")||dt(r,p),u&&!n.children||f===(f=e.child.visits+"")||dt(i,f);var a={};n.children&&(a.action=e.child.parentAction),v.$set(a),n.children&&vt(t,"clickable",e.children.length>0),n.selectedIndex&&vt(t,"selected",e.i===e.selectedIndex)},i(e){u||(Rt(v.$$.fragment,e),u=!0)},o(e){Ut(v.$$.fragment,e),u=!1},d(e){e&&nt(t),Ht(v),Te(d)}}}function xr(e){var t,n,r,o,a;let i=e.children,s=[];for(let t=0;t<i.length;t+=1)s[t]=br(yr(e,i,t));const l=e=>Ut(s[e],1,1,()=>{s[e]=null});return{c(){t=ot("table"),(n=ot("thead")).innerHTML='<th class="svelte-ztcwsu">Value</th> <th class="svelte-ztcwsu">Visits</th> <th class="svelte-ztcwsu">Action</th>',r=st(),o=ot("tbody");for(let e=0;e<s.length;e+=1)s[e].c();ut(t,"class","svelte-ztcwsu")},m(e,i){tt(e,t,i),et(t,n),et(t,r),et(t,o);for(let e=0;e<s.length;e+=1)s[e].m(o,null);a=!0},p(e,t){if(e.children||e.selectedIndex){let n;for(i=t.children,n=0;n<i.length;n+=1){const r=yr(t,i,n);s[n]?(s[n].p(e,r),Rt(s[n],1)):(s[n]=br(r),s[n].c(),Rt(s[n],1),s[n].m(o,null))}for(Lt(),n=i.length;n<s.length;n+=1)l(n);Tt()}},i(e){if(!a){for(let e=0;e<i.length;e+=1)Rt(s[e]);a=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)Ut(s[e]);a=!1},d(e){e&&nt(t),rt(s,e)}}}function $r(e,t,n){let{root:r,selectedIndex:o=null}=t;const a=Ot();let i=[],s=[];function l(e,t){a("select",{node:e,selectedIndex:t})}function c(e,t){null===o&&a("preview",{node:e})}return e.$set=e=>{"root"in e&&n("root",r=e.root),"selectedIndex"in e&&n("selectedIndex",o=e.selectedIndex)},e.$$.update=(e={root:1,parents:1})=>{if(e.root||e.parents){let e=r;for(n("parents",i=[]);e.parent;){const t=e.parent,{type:n,args:r}=e.parentAction.payload,o=`${n}(${(r||[]).join(",")})`;i.push({parent:t,arrowText:o}),e=t}i.reverse(),n("children",s=[...r.children].sort((e,t)=>e.visits<t.visits?1:-1).slice(0,50))}},{root:r,selectedIndex:o,children:s,Select:l,Preview:c,click_handler:({child:e,i:t})=>l(e,t),mouseout_handler:({i:e})=>c(null),mouseover_handler:({child:e,i:t})=>c(e)}}class wr extends Qt{constructor(e){var t;super(),document.getElementById("svelte-ztcwsu-style")||((t=ot("style")).id="svelte-ztcwsu-style",t.textContent="table.svelte-ztcwsu{font-size:12px;border-collapse:collapse;border:1px solid #ddd;padding:0}tr.svelte-ztcwsu{cursor:pointer}tr.svelte-ztcwsu:hover td.svelte-ztcwsu{background:#eee}tr.selected.svelte-ztcwsu td.svelte-ztcwsu{background:#eee}td.svelte-ztcwsu{padding:10px;height:10px;line-height:10px;font-size:12px;border:none}th.svelte-ztcwsu{background:#888;color:#fff;padding:10px;text-align:center}",et(document.head,t)),Yt(this,e,$r,xr,Ue,["root","selectedIndex"])}}function Pr(e,t,n){const r=Object.create(e);return r.node=t[n].node,r.selectedIndex=t[n].selectedIndex,r.i=n,r}function Or(e){var t;var n=new wr({props:{root:e.node,selectedIndex:e.selectedIndex}});return n.$on("select",(function(...t){return e.select_handler_1(e,...t)})),{c(){n.$$.fragment.c()},m(e,r){Jt(n,e,r),t=!0},p(t,r){e=r;var o={};t.nodes&&(o.root=e.node),t.nodes&&(o.selectedIndex=e.selectedIndex),n.$set(o)},i(e){t||(Rt(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Ht(n,e)}}}function kr(e){var t;var n=new wr({props:{root:e.node}});return n.$on("select",(function(...t){return e.select_handler(e,...t)})),n.$on("preview",(function(...t){return e.preview_handler(e,...t)})),{c(){n.$$.fragment.c()},m(e,r){Jt(n,e,r),t=!0},p(t,r){e=r;var o={};t.nodes&&(o.root=e.node),n.$set(o)},i(e){t||(Rt(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Ht(n,e)}}}function Ir(e){var t,n,r,o,a,i=0!==e.i&&function(e){var t,n,r=new vr({});return{c(){t=ot("div"),r.$$.fragment.c(),ut(t,"class","icon svelte-1f0amz4")},m(e,o){tt(e,t,o),Jt(r,t,null),n=!0},i(e){n||(Rt(r.$$.fragment,e),n=!0)},o(e){Ut(r.$$.fragment,e),n=!1},d(e){e&&nt(t),Ht(r)}}}(),s=[kr,Or],l=[];function c(e,t){return t.i===t.nodes.length-1?0:1}return r=c(0,e),o=l[r]=s[r](e),{c(){i&&i.c(),t=st(),n=ot("section"),o.c()},m(e,o){i&&i.m(e,o),tt(e,t,o),tt(e,n,o),l[r].m(n,null),a=!0},p(e,t){var a=r;(r=c(0,t))===a?l[r].p(e,t):(Lt(),Ut(l[a],1,1,()=>{l[a]=null}),Tt(),(o=l[r])||(o=l[r]=s[r](t)).c(),Rt(o,1),o.m(n,null))},i(e){a||(Rt(i),Rt(o),a=!0)},o(e){Ut(i),Ut(o),a=!1},d(e){i&&i.d(e),e&&(nt(t),nt(n)),l[r].d()}}}function _r(e){var t,n,r,o,a=new vr({}),i=new wr({props:{root:e.preview}});return{c(){t=ot("div"),a.$$.fragment.c(),n=st(),r=ot("section"),i.$$.fragment.c(),ut(t,"class","icon svelte-1f0amz4"),ut(r,"class","preview svelte-1f0amz4")},m(e,s){tt(e,t,s),Jt(a,t,null),tt(e,n,s),tt(e,r,s),Jt(i,r,null),o=!0},p(e,t){var n={};e.preview&&(n.root=t.preview),i.$set(n)},i(e){o||(Rt(a.$$.fragment,e),Rt(i.$$.fragment,e),o=!0)},o(e){Ut(a.$$.fragment,e),Ut(i.$$.fragment,e),o=!1},d(e){e&&nt(t),Ht(a),e&&(nt(n),nt(r)),Ht(i)}}}function Er(e){var t,n,r;let o=e.nodes,a=[];for(let t=0;t<o.length;t+=1)a[t]=Ir(Pr(e,o,t));const i=e=>Ut(a[e],1,1,()=>{a[e]=null});var s=e.preview&&_r(e);return{c(){t=ot("div");for(let e=0;e<a.length;e+=1)a[e].c();n=st(),s&&s.c(),ut(t,"class","visualizer svelte-1f0amz4")},m(e,o){tt(e,t,o);for(let e=0;e<a.length;e+=1)a[e].m(t,null);et(t,n),s&&s.m(t,null),r=!0},p(e,r){if(e.nodes){let s;for(o=r.nodes,s=0;s<o.length;s+=1){const i=Pr(r,o,s);a[s]?(a[s].p(e,i),Rt(a[s],1)):(a[s]=Ir(i),a[s].c(),Rt(a[s],1),a[s].m(t,n))}for(Lt(),s=o.length;s<a.length;s+=1)i(s);Tt()}r.preview?s?(s.p(e,r),Rt(s,1)):((s=_r(r)).c(),Rt(s,1),s.m(t,null)):s&&(Lt(),Ut(s,1,1,()=>{s=null}),Tt())},i(e){if(!r){for(let e=0;e<o.length;e+=1)Rt(a[e]);Rt(s),r=!0}},o(e){a=a.filter(Boolean);for(let e=0;e<a.length;e+=1)Ut(a[e]);Ut(s),r=!1},d(e){e&&nt(t),rt(a,e),s&&s.d()}}}function Dr(e,t,n){let{metadata:r}=t,o=[],a=null;function i({node:e,selectedIndex:t},r){n("preview",a=null),n("nodes",o[r].selectedIndex=t,o),n("nodes",o=[...o.slice(0,r+1),{node:e}])}function s({node:e},t){n("preview",a=e)}return e.$set=e=>{"metadata"in e&&n("metadata",r=e.metadata)},e.$$.update=(e={metadata:1})=>{e.metadata&&n("nodes",o=[{node:r}])},{metadata:r,nodes:o,preview:a,SelectNode:i,PreviewNode:s,select_handler:({i:e},t)=>i(t.detail,e),preview_handler:({i:e},t)=>s(t.detail),select_handler_1:({i:e},t)=>i(t.detail,e)}}class jr extends Qt{constructor(e){var t;super(),document.getElementById("svelte-1f0amz4-style")||((t=ot("style")).id="svelte-1f0amz4-style",t.textContent=".visualizer.svelte-1f0amz4{display:flex;flex-direction:column;align-items:center;padding:50px}.preview.svelte-1f0amz4{opacity:0.5}.icon.svelte-1f0amz4{color:#777;width:32px;height:32px;margin-bottom:20px}",et(document.head,t)),Yt(this,e,Dr,Er,Ue,["metadata"])}}function Sr(e,t,n){const r=Object.create(e);return r.phase=t[n].phase,r.i=n,r}function Ar(e,t,n){const r=Object.create(e);return r.action=t[n].action,r.payload=t[n].payload,r.i=n,r}function Cr(e,t,n){const r=Object.create(e);return r.turn=t[n].turn,r.i=n,r}function Mr(e){var t,n=new Wn({props:{turn:e.turn,numEvents:e.turnBoundaries[e.i]}});return{c(){n.$$.fragment.c()},m(e,r){Jt(n,e,r),t=!0},p(e,t){var r={};e.renderedLogEntries&&(r.turn=t.turn),e.turnBoundaries&&(r.numEvents=t.turnBoundaries[t.i]),n.$set(r)},i(e){t||(Rt(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Ht(n,e)}}}function zr(e){var t,n,r=e.i in e.turnBoundaries&&Mr(e);return{c(){r&&r.c(),t=lt()},m(e,o){r&&r.m(e,o),tt(e,t,o),n=!0},p(e,n){n.i in n.turnBoundaries?r?(r.p(e,n),Rt(r,1)):((r=Mr(n)).c(),Rt(r,1),r.m(t.parentNode,t)):r&&(Lt(),Ut(r,1,1,()=>{r=null}),Tt())},i(e){n||(Rt(r),n=!0)},o(e){Ut(r),n=!1},d(e){r&&r.d(e),e&&nt(t)}}}function Nr(e){var t,n=new ir({props:{pinned:e.i===e.pinned,logIndex:e.i,action:e.action,payload:e.payload}});return n.$on("click",e.OnLogClick),n.$on("mouseenter",e.OnMouseEnter),n.$on("mouseleave",e.OnMouseLeave),{c(){n.$$.fragment.c()},m(e,r){Jt(n,e,r),t=!0},p(e,t){var r={};e.pinned&&(r.pinned=t.i===t.pinned),e.renderedLogEntries&&(r.action=t.action),e.renderedLogEntries&&(r.payload=t.payload),n.$set(r)},i(e){t||(Rt(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Ht(n,e)}}}function Br(e){var t,n=new Xn({props:{phase:e.phase,numEvents:e.phaseBoundaries[e.i]}});return{c(){n.$$.fragment.c()},m(e,r){Jt(n,e,r),t=!0},p(e,t){var r={};e.renderedLogEntries&&(r.phase=t.phase),e.phaseBoundaries&&(r.numEvents=t.phaseBoundaries[t.i]),n.$set(r)},i(e){t||(Rt(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Ht(n,e)}}}function Gr(e){var t,n,r=e.i in e.phaseBoundaries&&Br(e);return{c(){r&&r.c(),t=lt()},m(e,o){r&&r.m(e,o),tt(e,t,o),n=!0},p(e,n){n.i in n.phaseBoundaries?r?(r.p(e,n),Rt(r,1)):((r=Br(n)).c(),Rt(r,1),r.m(t.parentNode,t)):r&&(Lt(),Ut(r,1,1,()=>{r=null}),Tt())},i(e){n||(Rt(r),n=!0)},o(e){Ut(r),n=!1},d(e){r&&r.d(e),e&&nt(t)}}}function qr(e){var t,n,r,o,a;let i=e.renderedLogEntries,s=[];for(let t=0;t<i.length;t+=1)s[t]=zr(Cr(e,i,t));const l=e=>Ut(s[e],1,1,()=>{s[e]=null});let c=e.renderedLogEntries,u=[];for(let t=0;t<c.length;t+=1)u[t]=Nr(Ar(e,c,t));const d=e=>Ut(u[e],1,1,()=>{u[e]=null});let p=e.renderedLogEntries,f=[];for(let t=0;t<p.length;t+=1)f[t]=Gr(Sr(e,p,t));const v=e=>Ut(f[e],1,1,()=>{f[e]=null});return{c(){t=ot("div");for(let e=0;e<s.length;e+=1)s[e].c();n=st();for(let e=0;e<u.length;e+=1)u[e].c();r=st();for(let e=0;e<f.length;e+=1)f[e].c();ut(t,"class","gamelog svelte-1pq5e4b"),vt(t,"pinned",e.pinned),a=ct(window,"keydown",e.OnKeyDown)},m(e,a){tt(e,t,a);for(let e=0;e<s.length;e+=1)s[e].m(t,null);et(t,n);for(let e=0;e<u.length;e+=1)u[e].m(t,null);et(t,r);for(let e=0;e<f.length;e+=1)f[e].m(t,null);o=!0},p(e,o){if(e.turnBoundaries||e.renderedLogEntries){let r;for(i=o.renderedLogEntries,r=0;r<i.length;r+=1){const a=Cr(o,i,r);s[r]?(s[r].p(e,a),Rt(s[r],1)):(s[r]=zr(a),s[r].c(),Rt(s[r],1),s[r].m(t,n))}for(Lt(),r=i.length;r<s.length;r+=1)l(r);Tt()}if(e.pinned||e.renderedLogEntries){let n;for(c=o.renderedLogEntries,n=0;n<c.length;n+=1){const a=Ar(o,c,n);u[n]?(u[n].p(e,a),Rt(u[n],1)):(u[n]=Nr(a),u[n].c(),Rt(u[n],1),u[n].m(t,r))}for(Lt(),n=c.length;n<u.length;n+=1)d(n);Tt()}if(e.phaseBoundaries||e.renderedLogEntries){let n;for(p=o.renderedLogEntries,n=0;n<p.length;n+=1){const r=Sr(o,p,n);f[n]?(f[n].p(e,r),Rt(f[n],1)):(f[n]=Gr(r),f[n].c(),Rt(f[n],1),f[n].m(t,null))}for(Lt(),n=p.length;n<f.length;n+=1)v(n);Tt()}e.pinned&&vt(t,"pinned",o.pinned)},i(e){if(!o){for(let e=0;e<i.length;e+=1)Rt(s[e]);for(let e=0;e<c.length;e+=1)Rt(u[e]);for(let e=0;e<p.length;e+=1)Rt(f[e]);o=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)Ut(s[e]);u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)Ut(u[e]);f=f.filter(Boolean);for(let e=0;e<f.length;e+=1)Ut(f[e]);o=!1},d(e){e&&nt(t),rt(s,e),rt(u,e),rt(f,e),a()}}}function Lr(e,t,n){let r,{client:o}=t;Ke(e,o,e=>{r=e,n("$client",r)});const{secondaryPane:a}=It("secondaryPane"),i=o.getInitialState();let s,{log:l}=r,c=null;function u(e){let t=i;for(let n=0;n<l.length;n++){const{action:r,automatic:a}=l[n];if(a||(t=o.reducer(t,r)),"MAKE_MOVE"==r.type){if(0==e)break;e--}}return{G:t.G,ctx:t.ctx}}function d(){n("pinned",c=null),o.overrideGameState(null),a.set(null)}Pt(d);let p={},f={};return e.$set=e=>{"client"in e&&n("client",o=e.client)},e.$$.update=(e={$client:1,log:1,renderedLogEntries:1})=>{if(e.$client||e.log||e.renderedLogEntries){n("log",l=r.log),n("renderedLogEntries",s=l.filter(e=>"MAKE_MOVE"==e.action.type));let e=0,t=0;n("turnBoundaries",p={}),n("phaseBoundaries",f={});for(let r=0;r<s.length;r++){const{action:o,payload:a,turn:i,phase:l}=s[r];t++,e++,r!=s.length-1&&s[r+1].turn==i||(n("turnBoundaries",p[r]=t,p),t=0),r!=s.length-1&&s[r+1].phase==l||(n("phaseBoundaries",f[r]=e,f),e=0)}}},{client:o,pinned:c,OnLogClick:function(e){const{logIndex:t}=e.detail,r=u(t),i=l.filter(e=>"MAKE_MOVE"==e.action.type);if(o.overrideGameState(r),c==t)n("pinned",c=null),a.set(null);else{n("pinned",c=t);const{metadata:e}=i[t].action.payload;e&&a.set({component:jr,metadata:e})}},OnMouseEnter:function(e){const{logIndex:t}=e.detail;if(null===c){const e=u(t);o.overrideGameState(e)}},OnMouseLeave:function(){null===c&&o.overrideGameState(null)},OnKeyDown:function(e){27==e.keyCode&&d()},renderedLogEntries:s,turnBoundaries:p,phaseBoundaries:f}}class Tr extends Qt{constructor(e){var t;super(),document.getElementById("svelte-1pq5e4b-style")||((t=ot("style")).id="svelte-1pq5e4b-style",t.textContent=".gamelog.svelte-1pq5e4b{display:grid;grid-template-columns:30px 1fr 30px;grid-auto-rows:auto;grid-auto-flow:column}",et(document.head,t)),Yt(this,e,Lr,qr,Ue,["client"])}}const{Object:Rr}=Vt;function Ur(e,t,n){const r=Rr.create(e);return r.key=t[n][0],r.value=t[n][1],r}function Kr(e){var t,n,r,o,a,i,s,l=e.values[e.key]+"";function c(){e.input_change_input_handler.call(o,e)}return{c(){t=ot("span"),n=it(l),r=st(),o=ot("input"),ut(t,"class","value svelte-7cel4i"),ut(o,"type","range"),ut(o,"min",a=e.value.range.min),ut(o,"max",i=e.value.range.max),s=[ct(o,"change",c),ct(o,"input",c),ct(o,"change",e.OnChange)]},m(a,i){tt(a,t,i),et(t,n),tt(a,r,i),tt(a,o,i),pt(o,e.values[e.key])},p(t,r){e=r,(t.values||t.bot)&&l!==(l=e.values[e.key]+"")&&dt(n,l),(t.values||t.Object||t.bot)&&pt(o,e.values[e.key]),t.bot&&a!==(a=e.value.range.min)&&ut(o,"min",a),t.bot&&i!==(i=e.value.range.max)&&ut(o,"max",i)},d(e){e&&(nt(t),nt(r),nt(o)),Te(s)}}}function Fr(e){var t,n;function r(){e.input_change_handler.call(t,e)}return{c(){ut(t=ot("input"),"type","checkbox"),ut(t,"class","svelte-7cel4i"),n=[ct(t,"change",r),ct(t,"change",e.OnChange)]},m(n,r){tt(n,t,r),t.checked=e.values[e.key]},p(n,r){e=r,(n.values||n.Object||n.bot)&&(t.checked=e.values[e.key])},d(e){e&&nt(t),Te(n)}}}function Vr(e){var t,n,r,o,a,i,s=e.key+"",l=e.value.range&&Kr(e),c="boolean"==typeof e.value.value&&Fr(e);return{c(){t=ot("div"),n=ot("label"),r=it(s),o=st(),l&&l.c(),a=st(),c&&c.c(),i=st(),ut(n,"class","svelte-7cel4i"),ut(t,"class","option svelte-7cel4i")},m(e,s){tt(e,t,s),et(t,n),et(n,r),et(t,o),l&&l.m(t,null),et(t,a),c&&c.m(t,null),et(t,i)},p(e,n){e.bot&&s!==(s=n.key+"")&&dt(r,s),n.value.range?l?l.p(e,n):((l=Kr(n)).c(),l.m(t,a)):l&&(l.d(1),l=null),"boolean"==typeof n.value.value?c?c.p(e,n):((c=Fr(n)).c(),c.m(t,i)):c&&(c.d(1),c=null)},d(e){e&&nt(t),l&&l.d(),c&&c.d()}}}function Jr(e){var t;let n=e.Object.entries(e.bot.opts()),r=[];for(let t=0;t<n.length;t+=1)r[t]=Vr(Ur(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=lt()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);tt(e,t,n)},p(e,o){if(e.Object||e.bot||e.values){let a;for(n=o.Object.entries(o.bot.opts()),a=0;a<n.length;a+=1){const i=Ur(o,n,a);r[a]?r[a].p(e,i):(r[a]=Vr(i),r[a].c(),r[a].m(t.parentNode,t))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},i:Ne,o:Ne,d(e){rt(r,e),e&&nt(t)}}}function Hr(e,t,n){let{bot:r}=t,o={};for(let[e,t]of Object.entries(r.opts()))n("values",o[e]=t.value,o);return e.$set=e=>{"bot"in e&&n("bot",r=e.bot)},{bot:r,values:o,OnChange:function(){for(let[e,t]of Object.entries(o))r.setOpt(e,t)},Object:Object,input_change_input_handler:function({key:e}){o[e]=function(e){return""===e?void 0:+e}(this.value),n("values",o),n("Object",Object),n("bot",r)},input_change_handler:function({key:e}){o[e]=this.checked,n("values",o),n("Object",Object),n("bot",r)}}}class Wr extends Qt{constructor(e){var t;super(),document.getElementById("svelte-7cel4i-style")||((t=ot("style")).id="svelte-7cel4i-style",t.textContent="label.svelte-7cel4i{font-weight:bold;color:#999}.option.svelte-7cel4i{margin-bottom:20px}.value.svelte-7cel4i{font-weight:bold}input[type='checkbox'].svelte-7cel4i{vertical-align:middle}",et(document.head,t)),Yt(this,e,Hr,Jr,Ue,["bot"])}}function Yr({game:e,isClient:t}){return e=ze(e),(n=null,r)=>{switch(r.type){case"GAME_EVENT":{if(n={...n,deltalog:[]},t)return n;if(void 0!==n.ctx.gameover)return _e("cannot call event after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return _e(`disallowed event: ${r.payload.type}`),n;n=Pe(n,{game:e,isClient:!1,playerID:r.payload.playerID});let o=e.flow.processEvent(n,r);return o=Oe(o,{game:e,isClient:!1}),{...o,_stateID:n._stateID+1}}case"MAKE_MOVE":{n={...n,deltalog:[]};const o=e.flow.getMove(n.ctx,r.payload.type,r.payload.playerID||n.ctx.currentPlayer);if(null===o)return _e(`disallowed move: ${r.payload.type}`),n;if(t&&!1===o.client)return n;if(void 0!==n.ctx.gameover)return _e("cannot make move after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return _e(`disallowed move: ${r.payload.type}`),n;n=Pe(n,{game:e,isClient:t,playerID:r.payload.playerID});let a=e.processMove(n,r.payload);if("INVALID_MOVE"===a)return _e(`invalid move: ${r.payload.type} args: ${r.payload.args}`),n;let i={action:r,_stateID:n._stateID,turn:n.ctx.turn,phase:n.ctx.phase};!0===o.redact&&(i.redact=!0);const s={...n,G:a,deltalog:[i],_stateID:n._stateID+1};if(t&&((e,t)=>[...xe,...t.game.plugins].filter(e=>void 0!==e.noClient).map(n=>{const r=n.name,o=e.plugins[r];return!!o&&n.noClient({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data})}).some(e=>!0===e))(s,{game:e}))return n;if(n=s,t)return n=Oe(n,{game:e,isClient:!0});const l=n.ctx.turn;return n=e.flow.processMove(n,r.payload),(n=Oe(n,{game:e})).ctx.turn!==l||e.disableUndo||(n._undo=n._undo.concat({G:n.G,ctx:n.ctx,moveType:r.payload.type})),n._redo=[],n}case"RESET":case"UPDATE":case"SYNC":return r.state;case"UNDO":{if(e.disableUndo)return _e("Undo is not enabled"),n;const{_undo:t,_redo:s}=n;if(t.length<2)return n;const l=t[t.length-1],c=t[t.length-2],u=e.flow.getMove(c.ctx,l.moveType,r.payload.playerID);return o=n.G,a=n.ctx,!function(e){return void 0!==e.undoable}(i=u)||(i.undoable instanceof Function?i.undoable(o,a):i.undoable)?{...n,G:c.G,ctx:c.ctx,_undo:t.slice(0,t.length-1),_redo:[l,...s]}:n}case"REDO":{const{_undo:t,_redo:r}=n;if(e.disableUndo)return _e("Redo is not enabled"),n;if(0==r.length)return n;const o=r[0];return{...n,G:o.G,ctx:o.ctx,_undo:[...t,o],_redo:r.slice(1)}}case"PLUGIN":return((e,t,n)=>(n.game.plugins.filter(e=>void 0!==e.action).filter(e=>e.name===t.payload.type).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},a=n.action(o.data,t.payload);e={...e,plugins:{...e.plugins,[r]:{...o,data:a}}}}),e))(n,r,{game:e});default:return n}var o,a,i}}class Qr{constructor({enumerate:e,seed:t}){this.enumerateFn=e,this.seed=t,this.iterationCounter=0,this._opts={}}addOpt({key:e,range:t,initial:n}){this._opts[e]={range:t,value:n}}getOpt(e){return this._opts[e].value}setOpt(e,t){e in this._opts&&(this._opts[e].value=t)}opts(){return this._opts}enumerate(e,t,n){return this.enumerateFn(e,t,n).map(e=>"payload"in e?e:"move"in e?d(e.move,e.args,n):"event"in e?p(e.event,e.args,n):void 0)}random(e){let t;if(void 0!==this.seed){let e=null;e=this.prngstate?new ge("",{state:this.prngstate}):new ge(this.seed,{state:!0}),t=e(),this.prngstate=e.state()}else t=Math.random();if(e){if(Array.isArray(e)){return e[Math.floor(t*e.length)]}return Math.floor(t*e)}return t}}class Xr extends Qr{constructor({enumerate:e,seed:t,objectives:n,game:r,iterations:o,playoutDepth:a,iterationCallback:i}){super({enumerate:e,seed:t}),void 0===n&&(n=()=>({})),this.objectives=n,this.iterationCallback=i||(()=>{}),this.reducer=Yr({game:r}),this.iterations=o,this.playoutDepth=a,this.addOpt({key:"async",initial:!1}),this.addOpt({key:"iterations",initial:"number"==typeof o?o:1e3,range:{min:1,max:2e3}}),this.addOpt({key:"playoutDepth",initial:"number"==typeof a?a:50,range:{min:1,max:100}})}createNode({state:e,parentAction:t,parent:n,playerID:r}){const{G:o,ctx:a}=e;let i=[],s=[];if(void 0!==r)i=this.enumerate(o,a,r),s=this.objectives(o,a,r);else if(a.activePlayers)for(let e in a.activePlayers)i=i.concat(this.enumerate(o,a,e)),s=s.concat(this.objectives(o,a,e));else i=i.concat(this.enumerate(o,a,a.currentPlayer)),s=s.concat(this.objectives(o,a,a.currentPlayer));return{state:e,parent:n,parentAction:t,actions:i,objectives:s,children:[],visits:0,value:0}}select(e){if(e.actions.length>0)return e;if(0==e.children.length)return e;let t=null,n=0;for(const r of e.children){const o=r.visits+Number.EPSILON,a=r.value/o+Math.sqrt(2*Math.log(e.visits)/o);(null==t||a>n)&&(n=a,t=r)}return this.select(t)}expand(e){const t=e.actions;if(0==t.length||void 0!==e.state.ctx.gameover)return e;const n=this.random(t.length),r=t[n];e.actions.splice(n,1);const o=this.reducer(e.state,r),a=this.createNode({state:o,parentAction:r,parent:e});return e.children.push(a),a}playout({state:e}){let t=this.getOpt("playoutDepth");"function"==typeof this.playoutDepth&&(t=this.playoutDepth(e.G,e.ctx));for(let n=0;n<t&&void 0===e.ctx.gameover;n++){const{G:t,ctx:n}=e;let r=n.currentPlayer;n.activePlayers&&(r=Object.keys(n.activePlayers)[0]);const o=this.enumerate(t,n,r),a=this.objectives(t,n,r),i=Object.keys(a).reduce((e,r)=>{const o=a[r];return o.checker(t,n)?e+o.weight:e},0);if(i>0)return{score:i};if(!o||0==o.length)return;const s=this.random(o.length);e=this.reducer(e,o[s])}return e.ctx.gameover}backpropagate(e,t={}){e.visits++,void 0!==t.score&&(e.value+=t.score),!0===t.draw&&(e.value+=.5),e.parentAction&&t.winner===e.parentAction.payload.playerID&&e.value++,e.parent&&this.backpropagate(e.parent,t)}play(e,t){const n=this.createNode({state:e,playerID:t});let r=this.getOpt("iterations");"function"==typeof this.iterations&&(r=this.iterations(e.G,e.ctx));const o=()=>{let e=null;for(const t of n.children)(null==e||t.visits>e.visits)&&(e=t);return{action:e&&e.parentAction,metadata:n}};return new Promise(e=>{const t=()=>{for(let e=0;e<25&&this.iterationCounter<r;e++){const e=this.select(n),t=this.expand(e),r=this.playout(t);this.backpropagate(t,r),this.iterationCounter++}this.iterationCallback({iterationCounter:this.iterationCounter,numIterations:r,metadata:n})};if(this.iterationCounter=0,this.getOpt("async")){const n=()=>{this.iterationCounter<r?(t(),setTimeout(n,0)):e(o())};n()}else{for(;this.iterationCounter<r;)t();e(o())}})}}class Zr extends Qr{play({G:e,ctx:t},n){const r=this.enumerate(e,t,n);return Promise.resolve({action:this.random(r)})}}async function eo(e,t){const n=e.store.getState();let r=n.ctx.currentPlayer;n.ctx.activePlayers&&(r=Object.keys(n.ctx.activePlayers)[0]);const{action:o,metadata:a}=await t.play(n,r);if(o){const t={...o,payload:{...o.payload,metadata:a}};return e.store.dispatch(t),t}}function to(e,t,n){const r=Object.create(e);return r.bot=t[n],r}function no(e){var t,n,r;return{c(){(t=ot("p")).textContent="No bots available.",n=st(),(r=ot("p")).innerHTML='\n\t\t\t        Follow the instructions\n\t\t\t        <a href="https://boardgame.io/documentation/#/tutorial?id=bots" target="_blank">\n\t\t\t          here</a>\n\t\t\t        to set up bots.\n\t\t\t      '},m(e,o){tt(e,t,o),tt(e,n,o),tt(e,r,o)},p:Ne,i:Ne,o:Ne,d(e){e&&(nt(t),nt(n),nt(r))}}}function ro(e){var t;return{c(){(t=ot("p")).textContent="The bot debugger is only available in singleplayer mode."},m(e,n){tt(e,t,n)},p:Ne,i:Ne,o:Ne,d(e){e&&nt(t)}}}function oo(e){var t,n,r,o,a,i,s,l,c,u,d,p,f,v,h,m,g,y,b=Object.keys(e.bot.opts()).length,x=new dn({props:{value:"1",onPress:e.Reset,label:"reset"}}),$=new dn({props:{value:"2",onPress:e.Step,label:"play"}}),w=new dn({props:{value:"3",onPress:e.Simulate,label:"simulate"}});let P=Object.keys(e.bots),O=[];for(let t=0;t<P.length;t+=1)O[t]=ao(to(e,P,t));var k=b&&io(e),I=(e.botAction||e.iterationCounter)&&so(e);return{c(){t=ot("section"),(n=ot("h3")).textContent="Controls",r=st(),o=ot("li"),x.$$.fragment.c(),a=st(),i=ot("li"),$.$$.fragment.c(),s=st(),l=ot("li"),w.$$.fragment.c(),c=st(),u=ot("section"),(d=ot("h3")).textContent="Bot",p=st(),f=ot("select");for(let e=0;e<O.length;e+=1)O[e].c();v=st(),k&&k.c(),h=st(),I&&I.c(),m=lt(),ut(n,"class","svelte-hsd9fq"),ut(o,"class","svelte-hsd9fq"),ut(i,"class","svelte-hsd9fq"),ut(l,"class","svelte-hsd9fq"),ut(d,"class","svelte-hsd9fq"),void 0===e.selectedBot&&Mt(()=>e.select_change_handler.call(f)),y=[ct(f,"change",e.select_change_handler),ct(f,"change",e.ChangeBot)]},m(y,b){tt(y,t,b),et(t,n),et(t,r),et(t,o),Jt(x,o,null),et(t,a),et(t,i),Jt($,i,null),et(t,s),et(t,l),Jt(w,l,null),tt(y,c,b),tt(y,u,b),et(u,d),et(u,p),et(u,f);for(let e=0;e<O.length;e+=1)O[e].m(f,null);ft(f,e.selectedBot),tt(y,v,b),k&&k.m(y,b),tt(y,h,b),I&&I.m(y,b),tt(y,m,b),g=!0},p(e,t){if(e.bots){let n;for(P=Object.keys(t.bots),n=0;n<P.length;n+=1){const r=to(t,P,n);O[n]?O[n].p(e,r):(O[n]=ao(r),O[n].c(),O[n].m(f,null))}for(;n<O.length;n+=1)O[n].d(1);O.length=P.length}e.selectedBot&&ft(f,t.selectedBot),e.bot&&(b=Object.keys(t.bot.opts()).length),b?k?(k.p(e,t),Rt(k,1)):((k=io(t)).c(),Rt(k,1),k.m(h.parentNode,h)):k&&(Lt(),Ut(k,1,1,()=>{k=null}),Tt()),t.botAction||t.iterationCounter?I?I.p(e,t):((I=so(t)).c(),I.m(m.parentNode,m)):I&&(I.d(1),I=null)},i(e){g||(Rt(x.$$.fragment,e),Rt($.$$.fragment,e),Rt(w.$$.fragment,e),Rt(k),g=!0)},o(e){Ut(x.$$.fragment,e),Ut($.$$.fragment,e),Ut(w.$$.fragment,e),Ut(k),g=!1},d(e){e&&nt(t),Ht(x),Ht($),Ht(w),e&&(nt(c),nt(u)),rt(O,e),e&&nt(v),k&&k.d(e),e&&nt(h),I&&I.d(e),e&&nt(m),Te(y)}}}function ao(e){var t,n,r=e.bot+"";return{c(){t=ot("option"),n=it(r),t.__value=e.bot,t.value=t.__value},m(e,r){tt(e,t,r),et(t,n)},p:Ne,d(e){e&&nt(t)}}}function io(e){var t,n,r,o,a,i,s,l,c,u=new Wr({props:{bot:e.bot}});return{c(){t=ot("section"),(n=ot("h3")).textContent="Options",r=st(),(o=ot("label")).textContent="debug",a=st(),i=ot("input"),s=st(),u.$$.fragment.c(),ut(n,"class","svelte-hsd9fq"),ut(o,"class","svelte-hsd9fq"),ut(i,"type","checkbox"),ut(i,"class","svelte-hsd9fq"),c=[ct(i,"change",e.input_change_handler),ct(i,"change",e.OnDebug)]},m(c,d){tt(c,t,d),et(t,n),et(t,r),et(t,o),et(t,a),et(t,i),i.checked=e.debug,et(t,s),Jt(u,t,null),l=!0},p(e,t){e.debug&&(i.checked=t.debug);var n={};e.bot&&(n.bot=t.bot),u.$set(n)},i(e){l||(Rt(u.$$.fragment,e),l=!0)},o(e){Ut(u.$$.fragment,e),l=!1},d(e){e&&nt(t),Ht(u),Te(c)}}}function so(e){var t,n,r,o,a=e.progress&&e.progress<1&&lo(e),i=e.botAction&&co(e);return{c(){t=ot("section"),(n=ot("h3")).textContent="Result",r=st(),a&&a.c(),o=st(),i&&i.c(),ut(n,"class","svelte-hsd9fq")},m(e,s){tt(e,t,s),et(t,n),et(t,r),a&&a.m(t,null),et(t,o),i&&i.m(t,null)},p(e,n){n.progress&&n.progress<1?a?a.p(e,n):((a=lo(n)).c(),a.m(t,o)):a&&(a.d(1),a=null),n.botAction?i?i.p(e,n):((i=co(n)).c(),i.m(t,null)):i&&(i.d(1),i=null)},d(e){e&&nt(t),a&&a.d(),i&&i.d()}}}function lo(e){var t;return{c(){(t=ot("progress")).value=e.progress},m(e,n){tt(e,t,n)},p(e,n){e.progress&&(t.value=n.progress)},d(e){e&&nt(t)}}}function co(e){var t,n,r,o,a,i,s,l=JSON.stringify(e.botActionArgs)+"";return{c(){t=ot("li"),n=it("Action: "),r=it(e.botAction),o=st(),a=ot("li"),i=it("Args: "),s=it(l),ut(t,"class","svelte-hsd9fq"),ut(a,"class","svelte-hsd9fq")},m(e,l){tt(e,t,l),et(t,n),et(t,r),tt(e,o,l),tt(e,a,l),et(a,i),et(a,s)},p(e,t){e.botAction&&dt(r,t.botAction),e.botActionArgs&&l!==(l=JSON.stringify(t.botActionArgs)+"")&&dt(s,l)},d(e){e&&(nt(t),nt(o),nt(a))}}}function uo(e){var t,n,r,o,a,i=[oo,ro,no],s=[];function l(e,t){return t.client.game.ai&&!t.client.multiplayer?0:t.client.multiplayer?1:2}return n=l(0,e),r=s[n]=i[n](e),{c(){t=ot("section"),r.c(),a=ct(window,"keydown",e.OnKeyDown)},m(e,r){tt(e,t,r),s[n].m(t,null),o=!0},p(e,o){var a=n;(n=l(0,o))===a?s[n].p(e,o):(Lt(),Ut(s[a],1,1,()=>{s[a]=null}),Tt(),(r=s[n])||(r=s[n]=i[n](o)).c(),Rt(r,1),r.m(t,null))},i(e){o||(Rt(r),o=!0)},o(e){Ut(r),o=!1},d(e){e&&nt(t),s[n].d(),a()}}}function po(e,t,n){let{client:r}=t;const{secondaryPane:o}=It("secondaryPane"),a={MCTS:Xr,Random:Zr};let i=!1,s=null,l=0,c=null;const u=({iterationCounter:e,numIterations:t,metadata:r})=>{n("iterationCounter",l=e),n("progress",s=e/t),c=r,i&&c&&o.set({component:jr,metadata:c})};let d,p,f,v;function h(){r.overrideGameState(null),o.set(null),n("debug",i=!1)}return r.game.ai&&(n("bot",d=new Xr({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),d.setOpt("async",!0)),Pt(h),e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,bots:a,debug:i,progress:s,iterationCounter:l,OnDebug:function(){i&&c?o.set({component:jr,metadata:c}):o.set(null)},bot:d,selectedBot:p,botAction:f,botActionArgs:v,ChangeBot:function(){n("bot",d=new(0,a[p])({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),d.setOpt("async",!0),n("botAction",f=null),c=null,o.set(null),n("iterationCounter",l=0)},Step:async function(){n("botAction",f=null),c=null,n("iterationCounter",l=0);const e=await eo(r,d);e&&(n("botAction",f=e.payload.type),n("botActionArgs",v=e.payload.args))},Simulate:function(e=1e4,t=100){return n("botAction",f=null),c=null,n("iterationCounter",l=0),(async()=>{for(let n=0;n<e;n++){if(!await eo(r,d))break;await new Promise(e=>setTimeout(e,t))}})()},Reset:function(){r.reset(),n("botAction",f=null),c=null,n("iterationCounter",l=0),h()},OnKeyDown:function(e){27==e.keyCode&&h()},select_change_handler:function(){p=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n("selectedBot",p),n("bots",a)},input_change_handler:function(){i=this.checked,n("debug",i)}}}class fo extends Qt{constructor(e){var t;super(),document.getElementById("svelte-hsd9fq-style")||((t=ot("style")).id="svelte-hsd9fq-style",t.textContent="li.svelte-hsd9fq{list-style:none;margin:none;margin-bottom:5px}h3.svelte-hsd9fq{text-transform:uppercase}label.svelte-hsd9fq{font-weight:bold;color:#999}input[type='checkbox'].svelte-hsd9fq{vertical-align:middle}",et(document.head,t)),Yt(this,e,po,uo,Ue,["client"])}}function vo(e){var t,n,r,o,a,i,s=new sn({props:{panes:e.panes,pane:e.pane}});s.$on("change",e.MenuChange);var l=e.panes[e.pane].component;function c(e){return{props:{client:e.client}}}if(l)var u=new l(c(e));var d=e.$secondaryPane&&ho(e);return{c(){t=ot("div"),s.$$.fragment.c(),n=st(),r=ot("div"),u&&u.$$.fragment.c(),o=st(),d&&d.c(),ut(r,"class","pane svelte-1h5kecx"),ut(t,"class","debug-panel svelte-1h5kecx")},m(e,a){tt(e,t,a),Jt(s,t,null),et(t,n),et(t,r),u&&Jt(u,r,null),et(t,o),d&&d.m(t,null),i=!0},p(e,n){var o={};e.pane&&(o.pane=n.pane),s.$set(o);var a={};if(e.client&&(a.client=n.client),l!==(l=n.panes[n.pane].component)){if(u){Lt();const e=u;Ut(e.$$.fragment,1,0,()=>{Ht(e,1)}),Tt()}l?((u=new l(c(n))).$$.fragment.c(),Rt(u.$$.fragment,1),Jt(u,r,null)):u=null}else l&&u.$set(a);n.$secondaryPane?d?(d.p(e,n),Rt(d,1)):((d=ho(n)).c(),Rt(d,1),d.m(t,null)):d&&(Lt(),Ut(d,1,1,()=>{d=null}),Tt())},i(e){i||(Rt(s.$$.fragment,e),u&&Rt(u.$$.fragment,e),Rt(d),Mt(()=>{a||(a=Ft(t,tn,{x:400},!0)),a.run(1)}),i=!0)},o(e){Ut(s.$$.fragment,e),u&&Ut(u.$$.fragment,e),Ut(d),a||(a=Ft(t,tn,{x:400},!1)),a.run(0),i=!1},d(e){e&&nt(t),Ht(s),u&&Ht(u),d&&d.d(),e&&a&&a.end()}}}function ho(e){var t,n,r=e.$secondaryPane.component;function o(e){return{props:{metadata:e.$secondaryPane.metadata}}}if(r)var a=new r(o(e));return{c(){t=ot("div"),a&&a.$$.fragment.c(),ut(t,"class","secondary-pane svelte-1h5kecx")},m(e,r){tt(e,t,r),a&&Jt(a,t,null),n=!0},p(e,n){var i={};if(e.$secondaryPane&&(i.metadata=n.$secondaryPane.metadata),r!==(r=n.$secondaryPane.component)){if(a){Lt();const e=a;Ut(e.$$.fragment,1,0,()=>{Ht(e,1)}),Tt()}r?((a=new r(o(n))).$$.fragment.c(),Rt(a.$$.fragment,1),Jt(a,t,null)):a=null}else r&&a.$set(i)},i(e){n||(a&&Rt(a.$$.fragment,e),n=!0)},o(e){a&&Ut(a.$$.fragment,e),n=!1},d(e){e&&nt(t),a&&Ht(a)}}}function mo(e){var t,n,r,o=e.visible&&vo(e);return{c(){o&&o.c(),t=lt(),r=ct(window,"keypress",e.Keypress)},m(e,r){o&&o.m(e,r),tt(e,t,r),n=!0},p(e,n){n.visible?o?(o.p(e,n),Rt(o,1)):((o=vo(n)).c(),Rt(o,1),o.m(t.parentNode,t)):o&&(Lt(),Ut(o,1,1,()=>{o=null}),Tt())},i(e){n||(Rt(o),n=!0)},o(e){Ut(o),n=!1},d(e){o&&o.d(e),e&&nt(t),r()}}}function go(e,t,n){let r,{client:o}=t;const a={main:{label:"Main",shortcut:"m",component:qn},log:{label:"Log",shortcut:"l",component:Tr},info:{label:"Info",shortcut:"i",component:Vn},ai:{label:"AI",shortcut:"a",component:fo}},i=Zt(!1),s=Zt(null);Ke(e,s,e=>{r=e,n("$secondaryPane",r)}),kt("hotkeys",{disableHotkeys:i}),kt("secondaryPane",{secondaryPane:s});let l="main";let c=!0;return e.$set=e=>{"client"in e&&n("client",o=e.client)},{client:o,panes:a,secondaryPane:s,pane:l,MenuChange:function(e){n("pane",l=e.detail)},visible:c,Keypress:function(e){"."!=e.key?c&&Object.entries(a).forEach(([t,{shortcut:r}])=>{e.key==r&&n("pane",l=t)}):n("visible",c=!c)},$secondaryPane:r}}class yo extends Qt{constructor(e){var t;super(),document.getElementById("svelte-1h5kecx-style")||((t=ot("style")).id="svelte-1h5kecx-style",t.textContent=".debug-panel.svelte-1h5kecx{position:fixed;color:#555;font-family:monospace;display:flex;flex-direction:row;text-align:left;right:0;top:0;height:100%;font-size:14px;box-sizing:border-box;opacity:0.9}.pane.svelte-1h5kecx{flex-grow:2;overflow-x:hidden;overflow-y:scroll;background:#fefefe;padding:20px;border-left:1px solid #ccc;box-shadow:-1px 0 5px rgba(0, 0, 0, 0.2);box-sizing:border-box;width:280px}.secondary-pane.svelte-1h5kecx{background:#fefefe;overflow-y:scroll}.debug-panel.svelte-1h5kecx button, select{cursor:pointer;outline:none;background:#eee;border:1px solid #bbb;color:#555;padding:3px;border-radius:3px}.debug-panel.svelte-1h5kecx button{padding-left:10px;padding-right:10px}.debug-panel.svelte-1h5kecx button:hover{background:#ddd}.debug-panel.svelte-1h5kecx button:active{background:#888;color:#fff}.debug-panel.svelte-1h5kecx section{margin-bottom:20px}",et(document.head,t)),Yt(this,e,go,mo,Ue,["client"])}}function bo({game:e,numPlayers:t,setupData:n}){t||(t=2);let r={G:{},ctx:(e=ze(e)).flow.ctx(t),plugins:{}};r=((e,t)=>([...xe,...t.game.plugins].filter(e=>void 0!==e.setup).forEach(n=>{const r=n.name,o=n.setup({G:e.G,ctx:e.ctx,game:t.game});e={...e,plugins:{...e.plugins,[r]:{data:o}}}}),e))(r,{game:e}),r=Pe(r,{game:e,playerID:void 0});const o=$e(r);r.G=e.setup(o,n);let a={...r,_undo:[],_redo:[],_stateID:0};return a=e.flow.init(a),a=Oe(a,{game:e}),a}function xo(e,t,n,r,o,a){return t.reduce((t,i)=>(t[i]=function(...t){let s=r;if(!a&&null==r){s=n.getState().ctx.currentPlayer}n.dispatch($[e](i,t,s,o))},t),{})}const $o=xo.bind(null,"makeMove"),wo=xo.bind(null,"gameEvent"),Po=xo.bind(null,"plugin");class Oo{constructor({game:e,debug:t,numPlayers:n,multiplayer:r,gameID:o,playerID:i,credentials:s,enhancer:l}){this.game=ze(e),this.playerID=i,this.gameID=o,this.credentials=s,this.multiplayer=r,this.debug=t,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=Yr({game:this.game,isClient:void 0!==r}),this.initialState=null,r||(this.initialState=bo({game:this.game,numPlayers:n})),this.reset=()=>{this.store.dispatch(h(this.initialState))},this.undo=()=>{this.store.dispatch(m(this.playerID,this.credentials))},this.redo=()=>{this.store.dispatch(g(this.playerID,this.credentials))},this.store=null,this.log=[];const d=e=>t=>n=>{const r=t(n),o=e.getState();switch(n.type){case"MAKE_MOVE":case"GAME_EVENT":{const e=o.deltalog;this.log=[...this.log,...e];break}case"RESET":this.log=[];break;case"UPDATE":{let e=-1;this.log.length>0&&(e=this.log[this.log.length-1]._stateID);let t=n.deltalog||[];t=t.filter(t=>t._stateID>e),this.log=[...this.log,...t];break}case"SYNC":this.initialState=n.initialState,this.log=n.log||[]}return r},p=e=>t=>n=>{const r=e.getState(),o=t(n);return"clientOnly"in n||this.transport.onAction(r,n),o},f=()=>e=>t=>{const n=e(t);return this.notifySubscribers(),n};l=void 0!==l?c(u(f,p,d),l):u(f,p,d),this.store=a(this.reducer,this.initialState,l),this.transport={isConnected:!0,onAction:()=>{},subscribe:()=>{},subscribeGameMetadata:()=>{},connect:()=>{},disconnect:()=>{},updateGameID:()=>{},updatePlayerID:()=>{}},r&&(this.transport=r({gameKey:e,game:this.game,store:this.store,gameID:o,playerID:i,gameName:this.game.name,numPlayers:n})),this.createDispatchers(),this.transport.subscribeGameMetadata(e=>{this.gameMetadata=e}),this._debugPanel=null}notifySubscribers(){Object.values(this.subscribers).forEach(e=>e(this.getState()))}overrideGameState(e){this.gameStateOverride=e,this.notifySubscribers()}start(){this.transport.connect(),this._running=!0;let e=null;if(e=yo,this.debug&&!0!==this.debug&&this.debug.impl&&(e=this.debug.impl),null!==e&&!1!==this.debug&&null==this._debugPanel&&"undefined"!=typeof document){let t=document.body;this.debug&&!0!==this.debug&&void 0!==this.debug.target&&(t=this.debug.target),t&&(this._debugPanel=new e({target:t,props:{client:this}}))}}stop(){this.transport.disconnect(),this._running=!1,null!=this._debugPanel&&(this._debugPanel.$destroy(),this._debugPanel=null)}subscribe(e){const t=Object.keys(this.subscribers).length;return this.subscribers[t]=e,this.transport.subscribe(()=>this.notifySubscribers()),!this._running&&this.multiplayer||e(this.getState()),()=>{delete this.subscribers[t]}}getInitialState(){return this.initialState}getState(){let e=this.store.getState();if(null!==this.gameStateOverride&&(e=this.gameStateOverride),null===e)return e;let t=!0;const n=this.game.flow.isPlayerActive(e.G,e.ctx,this.playerID);this.multiplayer&&!n&&(t=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||n||(t=!1),void 0!==e.ctx.gameover&&(t=!1);const r=this.game.playerView(e.G,e.ctx,this.playerID);return{...e,G:r,log:this.log,isActive:t,isConnected:this.transport.isConnected}}createDispatchers(){this.moves=$o(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=wo(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=Po(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}updatePlayerID(e){this.playerID=e,this.createDispatchers(),this.transport.updatePlayerID(e),this.notifySubscribers()}updateGameID(e){this.gameID=e,this.createDispatchers(),this.transport.updateGameID(e),this.notifySubscribers()}updateCredentials(e){this.credentials=e,this.createDispatchers(),this.notifySubscribers()}}e.Client=function(e){return new Oo(e)},Object.defineProperty(e,"__esModule",{value:!0})}));
